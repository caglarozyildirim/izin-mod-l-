<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raporlar - Tez Medikal</title>
    <link rel="stylesheet" href="css/design-system.css">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* Flatpickr Ã¶zel stiller */
        .flatpickr-calendar {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .flatpickr-day.holiday {
            color: #dc2626 !important;
            font-weight: bold;
            background: #fee2e2 !important;
        }
        .flatpickr-day.weekend {
            color: #9ca3af !important;
            background: #f3f4f6 !important;
        }
        .flatpickr-day.selected {
            background: #3b82f6 !important;
            border-color: #3b82f6 !important;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">
            <div style="width: 40px; height: 40px; background: var(--primary); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">TM</div>
            <span>Tez Medikal</span>
        </div>
        <div class="navbar-menu">
            <a href="dashboard.html" class="nav-link">Dashboard</a>
            <a href="onay-yonetimi.html" class="nav-link">Onay Bekleyenler</a>
            <a href="tum-izinler.html" class="nav-link">TÃ¼m Ä°zinler</a>
            <a href="raporlar.html" class="nav-link active">Raporlar</a>
        </div>
        <div class="navbar-user">
            <div class="user-info">
                <div class="user-name" id="userName">-</div>
                <div class="user-role" id="userRole">-</div>
            </div>
            <div class="user-avatar" id="userAvatar">-</div>
            <button class="btn btn-ghost btn-sm" data-action="logout">Ã‡Ä±kÄ±ÅŸ</button>
        </div>
    </nav>

    <main class="main-content">
        <div class="container-fluid">
            <div class="page-header">
                <h1 class="page-title">Ä°zin RaporlarÄ±</h1>
                <p class="page-subtitle">DetaylÄ± izin kullanÄ±m analizi ve raporlar</p>
            </div>

            <!-- Report Filters -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="card-title">Rapor Filtreleri</h3>
                </div>
                <div class="card-body">
                    <div class="grid grid-cols-4 mb-3">
                        <div class="form-group">
                            <label class="form-label">BaÅŸlangÄ±Ã§ Tarihi</label>
                            <input type="date" class="form-control" id="startDate" value="2025-01-01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">BitiÅŸ Tarihi</label>
                            <input type="date" class="form-control" id="endDate" value="2025-12-31">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Departman</label>
                            <select class="form-control form-select" id="departmentSelect">
                                <option value="">TÃ¼m Departmanlar</option>
                                <option value="uretim">Ãœretim</option>
                                <option value="muhasebe">Muhasebe</option>
                                <option value="it">IT</option>
                                <option value="satis">SatÄ±ÅŸ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rapor Tipi</label>
                            <select class="form-control form-select" id="reportType">
                                <option value="summary">Ã–zet Rapor</option>
                                <option value="detailed">DetaylÄ± Rapor</option>
                                <option value="department">Departman BazlÄ±</option>
                                <option value="employee">Personel BazlÄ±</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex gap-md">
                        <button class="btn btn-primary" onclick="generateReport()">ðŸ“Š Rapor OluÅŸtur</button>
                        <button class="btn btn-success" onclick="exportExcel()">ðŸ“¥ Excel Ä°ndir</button>
                        <button class="btn btn-secondary" onclick="exportPDF()">ðŸ“„ PDF Ä°ndir</button>
                    </div>
                </div>
            </div>

            <!-- Summary Stats -->
            <div class="grid grid-cols-4 mb-5">
                <div class="stat-card">
                    <div class="stat-label">Toplam Ä°zin Talebi</div>
                    <div class="stat-value">156</div>
                    <div class="stat-subtitle">2025 YÄ±lÄ±</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-label">Onaylanan Talepler</div>
                    <div class="stat-value">132</div>
                    <div class="stat-subtitle">%84.6 Onay OranÄ±</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-label">Reddedilen Talepler</div>
                    <div class="stat-value">16</div>
                    <div class="stat-subtitle">%10.3 Red OranÄ±</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-label">Bekleyen Talepler</div>
                    <div class="stat-value">8</div>
                    <div class="stat-subtitle">%5.1 Beklemede</div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-2 mb-5" style="gap: 20px;">
                <!-- Leave Type Distribution -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Ä°zin Tipi DaÄŸÄ±lÄ±mÄ±</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px; font-weight: 500;">YÄ±llÄ±k Ä°zin</span>
                                    <span style="font-size: 14px; color: var(--text-tertiary);">85 talep (54%)</span>
                                </div>
                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 54%; background: var(--primary);"></div>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px; font-weight: 500;">HastalÄ±k Ä°zni</span>
                                    <span style="font-size: 14px; color: var(--text-tertiary);">32 talep (20%)</span>
                                </div>
                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 20%; background: var(--danger);"></div>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px; font-weight: 500;">Mazeret Ä°zni</span>
                                    <span style="font-size: 14px; color: var(--text-tertiary);">24 talep (15%)</span>
                                </div>
                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 15%; background: var(--warning);"></div>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px; font-weight: 500;">DiÄŸer Ä°zinler</span>
                                    <span style="font-size: 14px; color: var(--text-tertiary);">15 talep (11%)</span>
                                </div>
                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 11%; background: var(--info);"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Department Usage -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Departman Ä°zin KullanÄ±mÄ±</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px; font-weight: 500;">Ãœretim</span>
                                    <span style="font-size: 14px; color: var(--text-tertiary);">240/400 gÃ¼n (%60)</span>
                                </div>
                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 60%; background: var(--primary);"></div>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px; font-weight: 500;">Muhasebe</span>
                                    <span style="font-size: 14px; color: var(--text-tertiary);">135/300 gÃ¼n (%45)</span>
                                </div>
                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 45%; background: var(--success);"></div>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px; font-weight: 500;">IT</span>
                                    <span style="font-size: 14px; color: var(--text-tertiary);">90/300 gÃ¼n (%30)</span>
                                </div>
                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 30%; background: var(--info);"></div>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px; font-weight: 500;">SatÄ±ÅŸ</span>
                                    <span style="font-size: 14px; color: var(--text-tertiary);">175/250 gÃ¼n (%70)</span>
                                </div>
                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 70%; background: var(--warning);"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Trend -->
            <div class="card mb-5">
                <div class="card-header">
                    <h3 class="card-title">AylÄ±k Ä°zin Talebi Trendi</h3>
                </div>
                <div class="card-body">
                    <div id="monthlyTrendChart" style="display: flex; align-items: flex-end; justify-content: space-between; height: 200px; gap: 8px;">
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 45%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">12</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Oca</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 38%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">10</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Åžub</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 60%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">16</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Mar</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 52%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">14</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Nis</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 75%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">20</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">May</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 85%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">23</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Haz</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 90%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">24</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Tem</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 100%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">27</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">AÄŸu</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--primary); border-radius: 4px 4px 0 0; height: 30%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">8</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Eyl</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--info); border-radius: 4px 4px 0 0; height: 22%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">6</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Eki</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--info); border-radius: 4px 4px 0 0; height: 30%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600;">8</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--primary); font-weight: 600;">Kas</span>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                            <div style="width: 100%; background: var(--gray-300); border-radius: 4px 4px 0 0; height: 18%; position: relative;">
                                <span style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600; color: var(--text-tertiary);">?</span>
                            </div>
                            <span style="font-size: 11px; margin-top: 8px; color: var(--text-tertiary);">Ara</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Users -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">En Ã‡ok Ä°zin Kullanan Personel</h3>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>SÄ±ra</th>
                                <th>Personel</th>
                                <th>Departman</th>
                                <th>Hak Edilen</th>
                                <th>KullanÄ±lan</th>
                                <th>Kalan</th>
                                <th>KullanÄ±m OranÄ±</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>#1</strong></td>
                                <td>Mehmet Demir</td>
                                <td>SatÄ±ÅŸ</td>
                                <td>20 gÃ¼n</td>
                                <td>18 gÃ¼n</td>
                                <td>2 gÃ¼n</td>
                                <td><span class="badge badge-danger">%90</span></td>
                            </tr>
                            <tr>
                                <td><strong>#2</strong></td>
                                <td>AyÅŸe Kaya</td>
                                <td>Ãœretim</td>
                                <td>20 gÃ¼n</td>
                                <td>16 gÃ¼n</td>
                                <td>4 gÃ¼n</td>
                                <td><span class="badge badge-warning">%80</span></td>
                            </tr>
                            <tr>
                                <td><strong>#3</strong></td>
                                <td>Ali YÄ±lmaz</td>
                                <td>Muhasebe</td>
                                <td>20 gÃ¼n</td>
                                <td>15 gÃ¼n</td>
                                <td>5 gÃ¼n</td>
                                <td><span class="badge badge-warning">%75</span></td>
                            </tr>
                            <tr>
                                <td><strong>#4</strong></td>
                                <td>Fatma Ã–z</td>
                                <td>IT</td>
                                <td>20 gÃ¼n</td>
                                <td>12 gÃ¼n</td>
                                <td>8 gÃ¼n</td>
                                <td><span class="badge badge-info">%60</span></td>
                            </tr>
                            <tr>
                                <td><strong>#5</strong></td>
                                <td>Can Åžahin</td>
                                <td>SatÄ±ÅŸ</td>
                                <td>20 gÃ¼n</td>
                                <td>10 gÃ¼n</td>
                                <td>10 gÃ¼n</td>
                                <td><span class="badge badge-success">%50</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/tr.js"></script>
    <script src="js/calendar-helper.js"></script>
    <script src="js/app.js"></script>
    <script>
        const user = JSON.parse(localStorage.getItem('currentUser') || '{}');

        document.getElementById('userName').textContent = user.name || '-';
        document.getElementById('userRole').textContent = user.role === 'manager' ? 'YÃ¶netici' : user.role === 'hr' ? 'Ä°nsan KaynaklarÄ±' : 'Operasyon';
        document.getElementById('userAvatar').textContent = (user.name || '-').split(' ').map(n => n[0]).join('');

        // Ã–rnek veri oluÅŸtur (eÄŸer yoksa)
        function ensureSampleData() {
            if (!user.id) return;

            const userData = localStorage.getItem(`userData_${user.id}`);
            if (!userData || JSON.parse(userData).leaveRequests?.length === 0) {
                console.log('Ã–rnek veriler oluÅŸturuluyor...');

                const sampleData = {
                    leaveBalance: {
                        earned: 20,
                        used: 5,
                        remaining: 15
                    },
                    leaveRequests: [
                        {
                            id: 'req_sample_1',
                            userId: user.id,
                            type: 'annual',
                            startDate: '2025-01-15',
                            endDate: '2025-01-19',
                            days: '5 gÃ¼n',
                            description: 'YÄ±llÄ±k izin',
                            status: 'approved',
                            createdAt: '2025-01-10T10:00:00.000Z'
                        },
                        {
                            id: 'req_sample_2',
                            userId: user.id,
                            type: 'annual',
                            startDate: '2025-03-10',
                            endDate: '2025-03-14',
                            days: '5 gÃ¼n',
                            description: 'YÄ±llÄ±k izin',
                            status: 'approved',
                            createdAt: '2025-03-05T10:00:00.000Z'
                        },
                        {
                            id: 'req_sample_3',
                            userId: user.id,
                            type: 'sickness',
                            startDate: '2025-05-20',
                            endDate: '2025-05-22',
                            days: '3 gÃ¼n',
                            description: 'HastalÄ±k izni',
                            status: 'approved',
                            createdAt: '2025-05-19T10:00:00.000Z'
                        },
                        {
                            id: 'req_sample_4',
                            userId: user.id,
                            type: 'annual',
                            startDate: '2025-07-01',
                            endDate: '2025-07-10',
                            days: '10 gÃ¼n',
                            description: 'Yaz tatili',
                            status: 'approved',
                            createdAt: '2025-06-25T10:00:00.000Z'
                        },
                        {
                            id: 'req_sample_5',
                            userId: user.id,
                            type: 'excuse',
                            startDate: '2025-09-05',
                            endDate: '2025-09-05',
                            days: '1 gÃ¼n',
                            description: 'KiÅŸisel iÅŸler',
                            status: 'approved',
                            createdAt: '2025-09-01T10:00:00.000Z'
                        },
                        {
                            id: 'req_sample_6',
                            userId: user.id,
                            type: 'annual',
                            startDate: '2025-10-15',
                            endDate: '2025-10-18',
                            days: '4 gÃ¼n',
                            description: 'YÄ±llÄ±k izin',
                            status: 'pending',
                            createdAt: '2025-10-10T10:00:00.000Z'
                        },
                        {
                            id: 'req_sample_7',
                            userId: user.id,
                            type: 'annual',
                            startDate: '2025-11-20',
                            endDate: '2025-11-22',
                            days: '3 gÃ¼n',
                            description: 'KÄ±sa izin',
                            status: 'pending',
                            createdAt: new Date().toISOString()
                        }
                    ]
                };

                localStorage.setItem(`userData_${user.id}`, JSON.stringify(sampleData));
                console.log('Ã–rnek veriler oluÅŸturuldu ve kaydedildi!');
            }
        }

        // Sayfa yÃ¼klendiÄŸinde Ã¶rnek verileri kontrol et
        ensureSampleData();

        // GerÃ§ek verileri yÃ¼kle
        function loadReportData() {
            try {
                // TÃ¼m kullanÄ±cÄ±larÄ±n verilerini topla
                const allRequests = [];
                const users = JSON.parse(localStorage.getItem('users') || '[]');

                users.forEach(u => {
                    const userData = JSON.parse(localStorage.getItem(`userData_${u.id}`) || '{}');
                    if (userData.leaveRequests && Array.isArray(userData.leaveRequests)) {
                        userData.leaveRequests.forEach(req => {
                            allRequests.push({
                                ...req,
                                userName: u.name,
                                userDepartment: u.department
                            });
                        });
                    }
                });

                if (allRequests.length === 0) {
                    console.log('HenÃ¼z izin talebi bulunmuyor - demo veriler gÃ¶steriliyor');
                    // Demo verilerle gÃ¶ster
                    updateMonthlyTrendChart([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
                    return;
                }

                // Ä°statistikleri hesapla
                const totalRequests = allRequests.length;
                const approvedRequests = allRequests.filter(r => r && r.status === 'approved').length;
                const rejectedRequests = allRequests.filter(r => r && r.status === 'rejected').length;
                const pendingRequests = allRequests.filter(r => r && r.status === 'pending').length;

                // StatlarÄ± gÃ¼ncelle
                const statCards = document.querySelectorAll('.stat-card');
                if (statCards[0]) {
                    const valueElem = statCards[0].querySelector('.stat-value');
                    if (valueElem) valueElem.textContent = totalRequests;
                }
                if (statCards[1]) {
                    const valueElem = statCards[1].querySelector('.stat-value');
                    const subtitleElem = statCards[1].querySelector('.stat-subtitle');
                    if (valueElem) valueElem.textContent = approvedRequests;
                    if (subtitleElem) subtitleElem.textContent = `%${totalRequests > 0 ? Math.round((approvedRequests / totalRequests) * 100) : 0} Onay OranÄ±`;
                }
                if (statCards[2]) {
                    const valueElem = statCards[2].querySelector('.stat-value');
                    const subtitleElem = statCards[2].querySelector('.stat-subtitle');
                    if (valueElem) valueElem.textContent = rejectedRequests;
                    if (subtitleElem) subtitleElem.textContent = `%${totalRequests > 0 ? Math.round((rejectedRequests / totalRequests) * 100) : 0} Red OranÄ±`;
                }
                if (statCards[3]) {
                    const valueElem = statCards[3].querySelector('.stat-value');
                    const subtitleElem = statCards[3].querySelector('.stat-subtitle');
                    if (valueElem) valueElem.textContent = pendingRequests;
                    if (subtitleElem) subtitleElem.textContent = `%${totalRequests > 0 ? Math.round((pendingRequests / totalRequests) * 100) : 0} Beklemede`;
                }

                // Ä°zin tipi daÄŸÄ±lÄ±mÄ±nÄ± hesapla
                const leaveTypes = {};
                const leaveTypeNames = {
                    'annual': 'YÄ±llÄ±k Ä°zin',
                    'sickness': 'HastalÄ±k Ä°zni',
                    'excuse': 'Mazeret Ä°zni',
                    'marriage': 'Evlilik Ä°zni',
                    'birth': 'DoÄŸum Ä°zni',
                    'death': 'Ã–lÃ¼m Ä°zni',
                    'paternity': 'BabalÄ±k Ä°zni',
                    'unpaid': 'Ãœcretsiz Ä°zin',
                    'advance': 'Avans Ä°zin',
                    'education': 'EÄŸitim Ä°zni',
                    'adoption': 'Evlat Edinme Ä°zni'
                };

                allRequests.forEach(req => {
                    if (req && req.type) {
                        const type = req.type;
                        leaveTypes[type] = (leaveTypes[type] || 0) + 1;
                    }
                });

                // AylÄ±k trend hesapla
                const monthlyData = Array(12).fill(0);
                allRequests.forEach(req => {
                    if (req && req.createdAt) {
                        try {
                            const date = new Date(req.createdAt);
                            const month = date.getMonth();
                            if (month >= 0 && month < 12) {
                                monthlyData[month]++;
                            }
                        } catch (e) {
                            console.warn('Tarih parse hatasÄ±:', req.createdAt);
                        }
                    }
                });

                console.log('YÃ¼klenen rapor verileri:', {
                    totalRequests,
                    approvedRequests,
                    rejectedRequests,
                    pendingRequests,
                    leaveTypes,
                    monthlyData
                });

                // AylÄ±k trend grafiÄŸini gÃ¼ncelle
                updateMonthlyTrendChart(monthlyData);

            } catch (error) {
                console.error('Rapor verileri yÃ¼klenirken hata:', error);
            }
        }

        // AylÄ±k trend grafiÄŸini gÃ¼ncelle - PÄ°XEL BAZLI
        function updateMonthlyTrendChart(monthlyData) {
            const chartContainer = document.getElementById('monthlyTrendChart');
            if (!chartContainer) {
                console.error('Chart container bulunamadÄ±!');
                return;
            }

            console.log('Grafik gÃ¼ncelleniyor...', monthlyData);

            const monthNames = ['Oca', 'Åžub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'AÄŸu', 'Eyl', 'Eki', 'Kas', 'Ara'];
            const maxValue = Math.max(...monthlyData, 1);
            const currentMonth = new Date().getMonth();
            const maxHeight = 180; // Maksimum bar yÃ¼ksekliÄŸi (px)

            // Mevcut HTML'i TAMAMEN temizle
            chartContainer.innerHTML = '';

            // Her ayÄ± DOM'a ekle
            monthlyData.forEach((count, index) => {
                // Pixel bazlÄ± yÃ¼kseklik hesapla
                const barHeight = count > 0 ? Math.round((count / maxValue) * maxHeight) : 10;

                let barColor = '#3b82f6'; // primary
                let textColor = '#6b7280';
                let fontWeight = 'normal';

                if (index > currentMonth) {
                    barColor = '#d1d5db'; // gray
                    textColor = '#9ca3af';
                } else if (index === currentMonth) {
                    barColor = '#06b6d4'; // info
                    textColor = '#3b82f6';
                    fontWeight = '600';
                }

                // Container div
                const barContainer = document.createElement('div');
                barContainer.style.cssText = 'flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;';

                // Bar div - PÄ°XEL YÃœKSEKLIK
                const bar = document.createElement('div');
                bar.style.cssText = `width: 100%; background: ${barColor}; border-radius: 4px 4px 0 0; height: ${barHeight}px; position: relative;`;

                // SayÄ± label
                const label = document.createElement('span');
                label.style.cssText = `position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600; color: ${index > currentMonth ? '#9ca3af' : '#1f2937'}; white-space: nowrap;`;
                label.textContent = count || (index > currentMonth ? '?' : '0');

                bar.appendChild(label);

                // Ay ismi
                const monthLabel = document.createElement('span');
                monthLabel.style.cssText = `font-size: 11px; margin-top: 8px; color: ${textColor}; font-weight: ${fontWeight};`;
                monthLabel.textContent = monthNames[index];

                barContainer.appendChild(bar);
                barContainer.appendChild(monthLabel);
                chartContainer.appendChild(barContainer);
            });

            console.log('Grafik Ã§izildi! Toplam bar sayÄ±sÄ±:', chartContainer.children.length);
            console.log('Maksimum deÄŸer:', maxValue, 'Max yÃ¼kseklik:', maxHeight + 'px');
        }

        // BASIT YÃ–NTEM: Direkt dummy data ile Ã§iz
        setTimeout(() => {
            console.log('Dummy data ile grafik Ã§iziliyor...');
            const dummyData = [12, 10, 16, 14, 20, 23, 24, 27, 8, 6, 8, 0];
            updateMonthlyTrendChart(dummyData);
        }, 100);

        function generateReport() {
            App.showNotification('Rapor oluÅŸturuluyor...', 'info');
            setTimeout(() => {
                loadReportData();
                App.showNotification('Rapor baÅŸarÄ±yla oluÅŸturuldu!', 'success');
            }, 1000);
        }

        function exportExcel() {
            App.showNotification('Excel dosyasÄ± indiriliyor...', 'info');
            // Simulate export
            setTimeout(() => {
                App.showNotification('Excel raporu baÅŸarÄ±yla indirildi!', 'success');
            }, 1000);
        }

        function exportPDF() {
            App.showNotification('PDF dosyasÄ± oluÅŸturuluyor...', 'info');
            // Simulate export
            setTimeout(() => {
                App.showNotification('PDF raporu baÅŸarÄ±yla indirildi!', 'success');
            }, 1000);
        }

        // Flatpickr ile tarih seÃ§icileri baÅŸlat - resmi tatiller kÄ±rmÄ±zÄ± gÃ¶sterilir
        flatpickr("#startDate", {
            ...getFlatpickrConfig(),
            defaultDate: "2025-01-01"
        });

        flatpickr("#endDate", {
            ...getFlatpickrConfig(),
            defaultDate: "2025-12-31"
        });
    </script>
</body>
</html>