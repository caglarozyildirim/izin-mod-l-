<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeni Ä°zin Talebi - Tez Medikal</title>
    <link rel="stylesheet" href="css/design-system.css">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        /* Flatpickr Ã¶zel stiller */
        .flatpickr-calendar {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .flatpickr-day.holiday {
            color: #dc2626 !important;
            font-weight: bold;
            background: #fee2e2 !important;
        }
        .flatpickr-day.weekend {
            color: #9ca3af !important;
            background: #f3f4f6 !important;
        }
        .flatpickr-day.selected {
            background: #3b82f6 !important;
            border-color: #3b82f6 !important;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">
            <div style="width: 40px; height: 40px; background: var(--primary); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">TM</div>
            <span>Tez Medikal</span>
        </div>
        <div class="navbar-menu">
            <a href="dashboard.html" class="nav-link">Dashboard</a>
            <a href="izinlerim.html" class="nav-link">Ä°zinlerim</a>
            <a href="yeni-talep.html" class="nav-link active">Yeni Talep</a>
        </div>
        <div class="navbar-user">
            <div class="user-info">
                <div class="user-name" id="userName">-</div>
                <div class="user-role" id="userRole">-</div>
            </div>
            <div class="user-avatar" id="userAvatar">-</div>
            <button class="btn btn-ghost btn-sm" data-action="logout">Ã‡Ä±kÄ±ÅŸ</button>
        </div>
    </nav>

    <main class="main-content">
        <div class="container-fluid" style="max-width: 1600px; margin: 0 auto;">
            <div class="page-header">
                <h1 class="page-title">Yeni Ä°zin Talebi</h1>
                <p class="page-subtitle">Ä°zin talebinizi oluÅŸturun</p>
            </div>

            <!-- Ä°zin Bakiyesi Bar -->
            <div class="grid grid-cols-3 mb-5">
                <!-- Hak Edilen Ä°zin - Calendar Icon -->
                <div class="stat-card" style="position: relative; overflow: visible;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div class="stat-label">Hak Edilen Ä°zin</div>
                            <div class="stat-value" id="earnedBalance" style="font-size: 42px;">20</div>
                            <div class="stat-subtitle">GÃ¼n</div>
                        </div>
                        <div style="position: relative;">
                            <svg width="70" height="70" viewBox="0 0 70 70" style="overflow: visible;">
                                <!-- Calendar base -->
                                <rect x="10" y="15" width="50" height="45" rx="4" fill="#e3f2fd" stroke="#2196F3" stroke-width="2" style="animation: fade-in-up 0.5s ease-out;"/>
                                <!-- Calendar header -->
                                <rect x="10" y="15" width="50" height="12" rx="4" fill="#2196F3" style="animation: fade-in-up 0.5s ease-out 0.1s both;"/>
                                <!-- Calendar rings -->
                                <circle cx="22" cy="15" r="3" fill="#1976D2" style="animation: pop-in 0.3s ease-out 0.3s both;"/>
                                <circle cx="48" cy="15" r="3" fill="#1976D2" style="animation: pop-in 0.3s ease-out 0.3s both;"/>
                                <!-- Checkmark -->
                                <path d="M 25 35 L 32 42 L 45 29" stroke="#4CAF50" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" style="animation: draw-line 0.8s ease-out 0.4s both;"/>
                            </svg>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 13px; color: #1976D2; display: flex; align-items: center; gap: 4px;">
                        <span style="font-weight: 600;">YÄ±llÄ±k</span> hakkÄ±nÄ±z
                    </div>
                </div>

                <!-- KullanÄ±lan Ä°zin - Progress Ring -->
                <div class="stat-card warning" style="position: relative; overflow: visible;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div class="stat-label">KullanÄ±lan Ä°zin</div>
                            <div class="stat-value" id="usedBalance" style="font-size: 42px;">5</div>
                            <div class="stat-subtitle">GÃ¼n</div>
                        </div>
                        <div style="position: relative;">
                            <svg width="80" height="80" style="transform: rotate(-90deg);">
                                <!-- Background circle -->
                                <circle cx="40" cy="40" r="32" fill="none" stroke="#fff3cd" stroke-width="6" opacity="0.3"/>
                                <!-- Progress circle (5/20 = 25%) -->
                                <circle id="usedProgressCircle" cx="40" cy="40" r="32" fill="none" stroke="#FFC107" stroke-width="6"
                                        stroke-dasharray="201" stroke-dashoffset="150"
                                        stroke-linecap="round"
                                        style="filter: drop-shadow(0 0 6px rgba(255, 193, 7, 0.5)); animation: fill-donut 1.5s ease-out;"/>
                            </svg>
                            <div id="usedPercentage" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                <div style="font-size: 15px; font-weight: 700; color: #F57C00; line-height: 1;">25%</div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 12px; height: 4px; background: rgba(255, 193, 7, 0.2); border-radius: 2px; overflow: hidden;">
                        <div id="usedProgressBar" style="height: 100%; width: 25%; background: linear-gradient(90deg, #FFC107, #F57C00); animation: progress-glow 2s ease-in-out infinite;"></div>
                    </div>
                </div>

                <!-- Kalan Ä°zin - Battery/Progress Bar -->
                <div class="stat-card success" style="position: relative; overflow: visible;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div class="stat-label">Kalan Ä°zin</div>
                            <div class="stat-value" id="remainingBalance" style="font-size: 42px;">15</div>
                            <div class="stat-subtitle">GÃ¼n</div>
                        </div>
                        <div style="position: relative;">
                            <svg width="70" height="70" viewBox="0 0 70 70">
                                <!-- Battery outline -->
                                <rect x="12" y="22" width="45" height="26" rx="3" fill="none" stroke="#4CAF50" stroke-width="2.5" style="animation: fade-in-up 0.5s ease-out;"/>
                                <!-- Battery tip -->
                                <rect x="57" y="30" width="4" height="10" rx="1" fill="#4CAF50" style="animation: fade-in-up 0.5s ease-out 0.1s both;"/>
                                <!-- Battery fill (75%) -->
                                <rect id="batteryFill" x="15" y="25" width="33" height="20" rx="2" fill="url(#gradient-battery)" style="animation: fade-in-up 0.8s ease-out 0.2s both;"/>
                                <defs>
                                    <linearGradient id="gradient-battery" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#2E7D32;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <!-- Sparkle -->
                                <path d="M 35 35 L 37 35 L 36 33 L 37 31 L 35 31 L 34 33 Z" fill="#FFF" opacity="0.8" style="animation: pop-in 0.4s ease-out 0.5s both;"/>
                            </svg>
                        </div>
                    </div>
                    <div id="remainingPercentage" style="margin-top: 12px; display: flex; gap: 4px; align-items: center; color: #2E7D32; font-size: 13px; font-weight: 600;">
                        <span style="font-size: 16px;">âœ“</span> %75 kalan
                    </div>
                </div>
            </div>

            <form id="leaveRequestForm">
                <!-- Ä°ki SÃ¼tun Layout -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(600px, 1fr)); gap: 24px; margin-bottom: 24px;">
                    <!-- Sol: Personel Bilgileri -->
                    <div class="card" style="border: none; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border-radius: 16px; overflow: hidden;">
                        <div class="card-header" style="background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%); padding: 20px 24px; border: none;">
                            <h3 class="card-title" style="color: white; font-size: 18px; margin: 0; font-weight: 600;">ğŸ‘¤ Personel Bilgileri</h3>
                        </div>
                        <div class="card-body" style="padding: 24px;">
                            <div class="form-group">
                                <label class="form-label">Ad Soyad</label>
                                <input type="text" class="form-control" id="fullName" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Departman</label>
                                <input type="text" class="form-control" id="department" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unvan</label>
                                <input type="text" class="form-control" id="title" value="Uzman" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Kurum</label>
                                <input type="text" class="form-control" id="company" value="Tez Medikal A.Å." readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">AnlaÅŸma Åekli</label>
                                <input type="text" class="form-control" id="contractType" value="Belirsiz SÃ¼reli" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ä°ÅŸ Yeri</label>
                                <select class="form-control form-select" id="workLocation">
                                    <option value="genel">Genel MÃ¼dÃ¼rlÃ¼k</option>
                                    <option value="saha">Saha</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ä°ÅŸ BaÅŸÄ± Tarihi</label>
                                <input type="text" class="form-control" id="startWorkDate" value="01.01.2020" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ä°zin Hak EdiÅŸ Tarihi</label>
                                <input type="text" class="form-control" id="leaveEarnDate" value="01.01.2025" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Talep Tarihi</label>
                                <input type="text" class="form-control" id="requestDate" readonly>
                            </div>
                        </div>
                    </div>

                    <!-- SaÄŸ: Ä°zin DetaylarÄ± -->
                    <div class="card" style="border: none; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border-radius: 16px; overflow: hidden;">
                    <div class="card-header" style="background: linear-gradient(135deg, #17A2B8 0%, #138496 100%); padding: 20px 24px; border: none;">
                        <h3 class="card-title" style="color: white; font-size: 18px; margin: 0; font-weight: 600;">ğŸ“ Ä°zin DetaylarÄ±</h3>
                    </div>
                    <div class="card-body" style="padding: 24px;">
                        <div class="form-group">
                            <label class="form-label form-label-required">Ä°zin Tipi</label>
                            <select class="form-control form-select" id="leaveType" required>
                                <option value="">SeÃ§iniz...</option>
                                <option value="annual">YÄ±llÄ±k Ä°zin</option>
                                <option value="marriage">Evlilik Ä°zni</option>
                                <option value="birth">DoÄŸum Ä°zni</option>
                                <option value="death">Ã–lÃ¼m Ä°zni</option>
                                <option value="excuse">Mazeret Ä°zni</option>
                                <option value="paternity">BabalÄ±k Ä°zni</option>
                                <option value="unpaid">Ãœcretsiz Ä°zin</option>
                                <option value="advance">Avans Ä°zin</option>
                                <option value="education">EÄŸitim Ä°zni</option>
                                <option value="sickness">HastalÄ±k Ä°zni</option>
                                <option value="adoption">Evlat Edinme Ä°zni</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-2">
                            <div class="form-group">
                                <label class="form-label form-label-required">BaÅŸlangÄ±Ã§ Tarihi</label>
                                <input type="date" class="form-control" id="startDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label form-label-required">BitiÅŸ Tarihi</label>
                                <input type="date" class="form-control" id="endDate" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label form-label-required">Ä°ÅŸe BaÅŸlangÄ±Ã§ Tarihi</label>
                            <input type="date" class="form-control" id="returnToWorkDate" required>
                        </div>

                        <!-- Mazeret Ä°zni Saat AlanlarÄ± -->
                        <div id="excuseTimeFields" style="display: none;">
                            <div class="grid grid-cols-2">
                                <div class="form-group">
                                    <label class="form-label">BaÅŸlangÄ±Ã§ Saati</label>
                                    <input type="time" class="form-control" id="startTime">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">BitiÅŸ Saati</label>
                                    <input type="time" class="form-control" id="endTime">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Toplam GÃ¼n</label>
                            <input type="text" class="form-control" id="totalDays" readonly value="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">AÃ§Ä±klama</label>
                            <textarea class="form-control" id="description" rows="4" placeholder="Ä°zin sebebinizi belirtiniz..."></textarea>
                        </div>

                        <!-- Dosya YÃ¼kleme AlanÄ± (Belirli Ä°zin Tipleri Ä°Ã§in) -->
                        <div class="form-group" id="documentUploadField" style="display: none;">
                            <label class="form-label form-label-required">Belge YÃ¼kle</label>
                            <input type="file" class="form-control" id="documentUpload" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" multiple>
                            <small class="form-text text-muted" id="documentHint">Bu izin tipi iÃ§in gerekli belgeleri yÃ¼klemeniz gerekmektedir.</small>
                        </div>

                        <!-- Ã–lÃ¼m Ä°zni Ä°Ã§in YakÄ±nlÄ±k Derecesi -->
                        <div class="form-group" id="relationshipDegreeField" style="display: none;">
                            <label class="form-label form-label-required">YakÄ±nlÄ±k Derecesi</label>
                            <select class="form-control form-select" id="relationshipDegree" required>
                                <option value="">SeÃ§iniz...</option>
                                <option value="anne">Anne</option>
                                <option value="baba">Baba</option>
                                <option value="es">EÅŸ</option>
                                <option value="cocuk">Ã‡ocuk</option>
                                <option value="diger">DiÄŸer</option>
                            </select>
                            <small class="form-text text-muted" id="relationshipHint">Anne/Baba/EÅŸ/Ã‡ocuk iÃ§in 3 gÃ¼n, diÄŸer yakÄ±nlar iÃ§in 1 gÃ¼n izin hakkÄ±nÄ±z bulunmaktadÄ±r.</small>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Saha Ã‡alÄ±ÅŸanÄ± Ä°Ã§in Ek Alanlar -->
                <div class="card mb-4" id="sahaFields" style="display: none; border: none; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border-radius: 16px; overflow: hidden;">
                    <div class="card-header" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 20px 24px; border: none;">
                        <h3 class="card-title" style="color: white; font-size: 18px; margin: 0; font-weight: 600;">ğŸ—ï¸ Saha Bilgileri</h3>
                    </div>
                    <div class="card-body" style="padding: 24px;">
                        <div class="form-group">
                            <label class="form-label">Ã‡alÄ±ÅŸan AtandÄ±ÄŸÄ± Lokasyonlar</label>
                            <div id="employeeLocationsContainer" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; background: #f9fafb; max-height: 400px; overflow-y: auto;">
                                <!-- Lokasyonlar liste formatÄ±nda JavaScript ile doldurulacak -->
                            </div>
                            <small class="form-text text-muted">Ä°zine Ã§Ä±kacak olan Ã§alÄ±ÅŸanÄ±n atandÄ±ÄŸÄ± lokasyonlar ve proje liderleri listelenmektedir.</small>
                        </div>

                        <div class="form-check">
                            <input type="checkbox" id="noServiceGap" class="form-check-input">
                            <label class="form-check-label" for="noServiceGap">
                                Eksik hizmet oluÅŸmayacak
                            </label>
                        </div>

                        <div id="serviceGapFields" style="margin-top: 16px;">
                            <div class="form-group">
                                <label class="form-label">Eksik Hizmet SaÄŸlayacak Firmalar (Ã‡oklu SeÃ§im)</label>
                                <div id="serviceCompaniesContainer" style="display: flex; flex-direction: column; gap: 16px; padding: 16px; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb;">
                                    <!-- JavaScript ile doldurulacak -->
                                </div>
                                <small class="form-text text-muted">Her firma iÃ§in saat bilgisi girebilirsiniz</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="card" style="border: none; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border-radius: 16px; overflow: hidden;">
                    <div class="card-body" style="padding: 24px;">
                        <div class="flex gap-md justify-end">
                            <a href="dashboard.html" class="btn btn-secondary">Ä°ptal</a>
                            <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 12px 32px; font-weight: 600;">âœ“ Talebi GÃ¶nder</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/tr.js"></script>
    <script src="js/calendar-helper.js"></script>
    <script src="js/app.js"></script>
    <script src="js/workflow-engine.js"></script>
    <script>
        const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
        const userData = JSON.parse(localStorage.getItem(`userData_${user.id}`) || '{}');

        document.getElementById('userName').textContent = user.name || '-';
        document.getElementById('userRole').textContent = user.role === 'employee' ? 'Personel' : 'YÃ¶netici';
        document.getElementById('userAvatar').textContent = (user.name || '-').split(' ').map(n => n[0]).join('');
        document.getElementById('fullName').value = user.name || '';
        document.getElementById('department').value = user.department || '';

        // Unvan role gÃ¶re ayarla
        const titleMap = {
            'employee': 'Uzman',
            'manager': 'YÃ¶netici',
            'hr': 'Ä°nsan KaynaklarÄ± UzmanÄ±',
            'operation': 'Operasyon YÃ¶neticisi',
            'customerRelations': 'MÃ¼ÅŸteri Ä°liÅŸkileri UzmanÄ±'
        };
        document.getElementById('title').value = titleMap[user.role] || 'Uzman';

        // Saha alanlarÄ±nÄ± gÃ¶ster/gizle fonksiyonu
        function toggleSahaFields() {
            const workLocation = document.getElementById('workLocation').value;
            const sahaFields = document.getElementById('sahaFields');

            if (workLocation === 'saha') {
                sahaFields.style.display = 'block';
                console.log('Saha alanlarÄ± gÃ¶steriliyor');
            } else {
                sahaFields.style.display = 'none';
                console.log('Saha alanlarÄ± gizleniyor');
            }
        }

        // Ä°ÅŸ yeri varsayÄ±lan deÄŸerini ayarla (departmana gÃ¶re)
        const sahaKeywords = ['Ã¼retim', 'saha', 'teknik', 'servis', 'montaj', 'bakÄ±m'];
        const userDepartment = (user.department || '').toLowerCase();
        const isSaha = sahaKeywords.some(keyword => userDepartment.includes(keyword));
        document.getElementById('workLocation').value = isSaha ? 'saha' : 'genel';

        // Sayfa yÃ¼klendiÄŸinde saha alanlarÄ±nÄ± kontrol et
        toggleSahaFields();

        // Talep tarihini bugÃ¼nÃ¼n tarihi olarak ayarla
        const today = new Date().toLocaleDateString('tr-TR');
        document.getElementById('requestDate').value = today;

        if (userData.leaveBalance) {
            const earned = userData.leaveBalance.earned || 20;
            const used = userData.leaveBalance.used || 5;
            const remaining = userData.leaveBalance.remaining || 15;

            document.getElementById('earnedBalance').textContent = earned;
            document.getElementById('usedBalance').textContent = used;
            document.getElementById('remainingBalance').textContent = remaining;

            // Calculate percentages
            const usedPercentage = Math.round((used / earned) * 100);
            const remainingPercentage = Math.round((remaining / earned) * 100);

            // Update used leave progress ring and bar
            const usedCircumference = 201; // 2 * Ï€ * r where r=32
            const usedOffset = usedCircumference - (usedCircumference * usedPercentage / 100);
            const progressCircle = document.getElementById('usedProgressCircle');
            if (progressCircle) {
                progressCircle.style.strokeDashoffset = usedOffset;
            }
            document.getElementById('usedPercentage').querySelector('div').textContent = usedPercentage + '%';
            document.getElementById('usedProgressBar').style.width = usedPercentage + '%';

            // Update remaining leave battery fill
            const batteryMaxWidth = 39; // Max width of battery fill
            const batteryWidth = (batteryMaxWidth * remainingPercentage / 100);
            document.getElementById('batteryFill').setAttribute('width', batteryWidth);
            document.getElementById('remainingPercentage').innerHTML = '<span style="font-size: 16px;">âœ“</span> %' + remainingPercentage + ' kalan';
        }

        // Mock data: Lokasyonlar (Her lokasyon = 1 proje + 1 lider)
        const locations = {
            'ankara_proje_1': {
                name: 'Ankara Proje SahasÄ± - Proje A',
                code: 'ANK-001-A',
                projectName: 'Ankara Proje A',
                leader: 'Mehmet Kaya',
                companies: ['ABC GÃ¼venlik', 'Securitas', 'Koruma Ltd.']
            },
            'ankara_proje_2': {
                name: 'Ankara Proje SahasÄ± - Proje B',
                code: 'ANK-001-B',
                projectName: 'Ankara Proje B',
                leader: 'Ahmet YÄ±lmaz',
                companies: ['ABC GÃ¼venlik', 'Securitas', 'Koruma Ltd.']
            },
            'istanbul_fabrika_1': {
                name: 'Ä°stanbul Fabrika A - Ãœretim HattÄ± 1',
                code: 'IST-002-1',
                projectName: 'Ä°stanbul Ãœretim 1',
                leader: 'AyÅŸe Demir',
                companies: ['XYZ Temizlik', 'Lojistik A.Å.', 'Koruma Ltd.']
            },
            'istanbul_fabrika_2': {
                name: 'Ä°stanbul Fabrika A - Ãœretim HattÄ± 2',
                code: 'IST-002-2',
                projectName: 'Ä°stanbul Ãœretim 2',
                leader: 'Can Ã–ztÃ¼rk',
                companies: ['XYZ Temizlik', 'Lojistik A.Å.', 'Koruma Ltd.']
            },
            'izmir_proje': {
                name: 'Ä°zmir Proje SahasÄ±',
                code: 'IZM-003',
                projectName: 'Ä°zmir Ana Proje',
                leader: 'Ali Yurt',
                companies: ['DEF GÃ¼venlik', 'Koruma Ltd.', 'GÃ¼ven Hizmetleri']
            },
            'bursa_proje': {
                name: 'Bursa Proje SahasÄ±',
                code: 'BUR-004',
                projectName: 'Bursa Tesis Projesi',
                leader: 'Kemal Acar',
                companies: ['Securitas', 'ABC GÃ¼venlik', 'Temizlik Hizmetleri']
            }
        };

        // Ã‡alÄ±ÅŸanÄ±n lokasyon gÃ¶revlendirmeleri (tarih aralÄ±klarÄ± ile)
        const employeeLocationAssignments = [
            {
                locationKey: 'ankara_proje_1',
                startDate: '2025-01-01',
                endDate: '2025-11-15'
            },
            {
                locationKey: 'ankara_proje_2',
                startDate: '2025-11-16',
                endDate: '2025-12-31'
            },
            {
                locationKey: 'istanbul_fabrika_1',
                startDate: '2025-10-01',
                endDate: '2025-11-10'
            },
            {
                locationKey: 'izmir_proje',
                startDate: '2025-11-20',
                endDate: '2025-12-20'
            }
        ];

        // Ä°ÅŸ gÃ¼nÃ¼ hesaplama (hafta sonlarÄ± hariÃ§)
        function calculateWorkingDays(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            let count = 0;
            const current = new Date(start);

            while (current <= end) {
                const dayOfWeek = current.getDay();
                if (dayOfWeek !== 0 && dayOfWeek !== 6) { // 0 = Pazar, 6 = Cumartesi
                    count++;
                }
                current.setDate(current.getDate() + 1);
            }

            return count;
        }

        // Ä°ki tarih aralÄ±ÄŸÄ±nÄ±n Ã§akÄ±ÅŸÄ±p Ã§akÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol et
        function dateRangesOverlap(start1, end1, start2, end2) {
            const s1 = new Date(start1);
            const e1 = new Date(end1);
            const s2 = new Date(start2);
            const e2 = new Date(end2);
            return s1 <= e2 && s2 <= e1;
        }

        // Ä°ki tarih aralÄ±ÄŸÄ±nÄ±n Ã§akÄ±ÅŸan kÄ±smÄ±nÄ± hesapla
        function getOverlapDates(start1, end1, start2, end2) {
            const s1 = new Date(start1);
            const e1 = new Date(end1);
            const s2 = new Date(start2);
            const e2 = new Date(end2);

            // Ã‡akÄ±ÅŸma yoksa null dÃ¶n
            if (s1 > e2 || s2 > e1) {
                return null;
            }

            // Ã‡akÄ±ÅŸan tarih aralÄ±ÄŸÄ±
            const overlapStart = new Date(Math.max(s1.getTime(), s2.getTime()));
            const overlapEnd = new Date(Math.min(e1.getTime(), e2.getTime()));

            return {
                start: overlapStart,
                end: overlapEnd,
                days: calculateWorkingDays(overlapStart, overlapEnd)
            };
        }

        // Tarihi formatla (DD.MM.YYYY)
        function formatDateTR(dateStr) {
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }

        // Ã‡alÄ±ÅŸanÄ±n atandÄ±ÄŸÄ± lokasyonlarÄ± liste formatÄ±nda render et
        function renderEmployeeLocations() {
            const container = document.getElementById('employeeLocationsContainer');

            if (employeeLocationAssignments.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #6b7280;">
                        <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“</div>
                        <div>Bu Ã§alÄ±ÅŸana atanmÄ±ÅŸ lokasyon bulunmamaktadÄ±r</div>
                    </div>
                `;
                return;
            }

            // SeÃ§ili izin tarihlerini al
            const leaveStartDate = document.getElementById('startDate')?.value;
            const leaveEndDate = document.getElementById('endDate')?.value;

            container.innerHTML = employeeLocationAssignments.map((assignment, index) => {
                const location = locations[assignment.locationKey];

                // Ä°zin tarihleri ile gÃ¶revlendirme Ã§akÄ±ÅŸÄ±yor mu?
                const isOverlapping = leaveStartDate && leaveEndDate &&
                    dateRangesOverlap(assignment.startDate, assignment.endDate, leaveStartDate, leaveEndDate);

                // Ã‡akÄ±ÅŸan gÃ¼nleri hesapla
                const overlapInfo = isOverlapping ?
                    getOverlapDates(assignment.startDate, assignment.endDate, leaveStartDate, leaveEndDate) : null;

                // Ã‡akÄ±ÅŸan lokasyonlara Ã¶zel stil
                const borderColor = isOverlapping ? '#f59e0b' : '#e5e7eb';
                const bgColor = isOverlapping ? '#fffbeb' : 'white';
                const highlightBadge = isOverlapping && overlapInfo ? `
                    <span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background: #f59e0b; color: white; border-radius: 6px; font-size: 11px; font-weight: 600;">
                        âš ï¸ ${overlapInfo.days} Ä°ÅŸ GÃ¼nÃ¼ Ã‡akÄ±ÅŸÄ±yor
                    </span>
                ` : '';

                // Ã‡akÄ±ÅŸan tarih aralÄ±ÄŸÄ± bilgisi
                const overlapDateInfo = isOverlapping && overlapInfo ? `
                    <div style="background: linear-gradient(135deg, #fef3c715 0%, #fde68a15 100%); padding: 12px; border-radius: 8px; margin-top: 12px; border: 1px solid #fbbf24;">
                        <div style="font-size: 11px; color: #92400e; margin-bottom: 6px; font-weight: 700; text-transform: uppercase;">âš ï¸ Ã‡akÄ±ÅŸan Tarih AralÄ±ÄŸÄ±</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                            <div>
                                <div style="font-size: 10px; color: #78350f; margin-bottom: 3px; font-weight: 600;">BaÅŸlangÄ±Ã§</div>
                                <div style="font-size: 12px; font-weight: 700; color: #92400e;">${formatDateTR(overlapInfo.start)}</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; color: #78350f; margin-bottom: 3px; font-weight: 600;">BitiÅŸ</div>
                                <div style="font-size: 12px; font-weight: 700; color: #92400e;">${formatDateTR(overlapInfo.end)}</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; color: #78350f; margin-bottom: 3px; font-weight: 600;">Ä°ÅŸ GÃ¼nÃ¼</div>
                                <div style="font-size: 12px; font-weight: 700; color: #92400e;">${overlapInfo.days} gÃ¼n</div>
                            </div>
                        </div>
                    </div>
                ` : '';

                return `
                    <div style="display: block; padding: 16px; margin-bottom: 12px; border: 2px solid ${borderColor}; border-radius: 8px; background: ${bgColor}; transition: all 0.3s;">
                        <div style="display: flex; align-items: start; gap: 12px;">
                            <div style="font-size: 24px;">ğŸ“</div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                    <div>
                                        <div style="font-weight: 600; color: #1f2937; font-size: 15px;">${location.name}</div>
                                        <div style="font-size: 12px; color: #6b7280; margin-top: 2px;">Kod: ${location.code}</div>
                                    </div>
                                    ${highlightBadge}
                                </div>
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid ${isOverlapping ? '#fbbf24' : '#e5e7eb'};">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                                        <div>
                                            <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px; font-weight: 600;">ğŸ“… GÃ¶revlendirme BaÅŸlangÄ±Ã§</div>
                                            <div style="font-size: 13px; font-weight: 600; color: #1f2937;">${formatDateTR(assignment.startDate)}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px; font-weight: 600;">ğŸ“… GÃ¶revlendirme BitiÅŸ</div>
                                            <div style="font-size: 13px; font-weight: 600; color: #1f2937;">${formatDateTR(assignment.endDate)}</div>
                                        </div>
                                    </div>
                                    ${overlapDateInfo}
                                    <div style="display: flex; align-items: center; gap: 8px; margin-top: 12px;">
                                        <span style="font-size: 12px; font-weight: 600; color: #6b7280;">Proje Lideri:</span>
                                        <span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: ${isOverlapping ? '#fef3c7' : '#f3f4f6'}; border-radius: 6px; font-size: 13px; color: #374151;">
                                            <span style="font-size: 12px;">ğŸ‘¤</span>
                                            ${location.leader}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // TÃ¼m lokasyonlardaki firmalarÄ± topla ve firma listesini doldur
        function populateAllServiceCompanies() {
            const container = document.getElementById('serviceCompaniesContainer');
            container.innerHTML = '';

            // TÃ¼m firmalalarÄ± benzersiz ÅŸekilde topla
            const allCompanies = new Set();
            Object.values(locations).forEach(location => {
                location.companies.forEach(company => allCompanies.add(company));
            });

            // Alfabetik sÄ±rala ve her firma iÃ§in checkbox + saat alanlarÄ± oluÅŸtur
            Array.from(allCompanies).sort().forEach(company => {
                const companyDiv = document.createElement('div');
                companyDiv.style.cssText = 'padding: 12px; background: white; border: 2px solid #e5e7eb; border-radius: 8px;';

                companyDiv.innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" class="company-checkbox" value="${company}" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-weight: 600; font-size: 14px; color: #1f2937;">${company}</span>
                        </label>
                        <div class="company-time-fields" style="display: none; grid-template-columns: 1fr 1fr; gap: 12px; margin-left: 28px;">
                            <div>
                                <label style="display: block; font-size: 12px; color: #6b7280; margin-bottom: 4px; font-weight: 500;">BaÅŸlangÄ±Ã§ Saati</label>
                                <input type="time" class="form-control company-start-time" data-company="${company}" style="padding: 8px;">
                            </div>
                            <div>
                                <label style="display: block; font-size: 12px; color: #6b7280; margin-bottom: 4px; font-weight: 500;">BitiÅŸ Saati</label>
                                <input type="time" class="form-control company-end-time" data-company="${company}" style="padding: 8px;">
                            </div>
                        </div>
                    </div>
                `;

                // Checkbox deÄŸiÅŸtiÄŸinde saat alanlarÄ±nÄ± gÃ¶ster/gizle
                const checkbox = companyDiv.querySelector('.company-checkbox');
                const timeFields = companyDiv.querySelector('.company-time-fields');
                checkbox.addEventListener('change', function() {
                    timeFields.style.display = this.checked ? 'grid' : 'none';
                });

                container.appendChild(companyDiv);
            });
        }

        // Sayfa yÃ¼klendiÄŸinde lokasyonlarÄ± ve firmalarÄ± render et
        document.addEventListener('DOMContentLoaded', () => {
            renderEmployeeLocations();
            populateAllServiceCompanies();
        });


        // Ä°zin tipi deÄŸiÅŸtiÄŸinde
        const documentRequiredTypes = ['sickness', 'birth', 'marriage']; // death Ã§Ä±karÄ±ldÄ±
        document.getElementById('leaveType').addEventListener('change', function() {
            const excuseFields = document.getElementById('excuseTimeFields');
            const documentField = document.getElementById('documentUploadField');
            const documentHint = document.getElementById('documentHint');
            const relationshipField = document.getElementById('relationshipDegreeField');
            const relationshipDegree = document.getElementById('relationshipDegree');

            excuseFields.style.display = this.value === 'excuse' ? 'block' : 'none';

            // Ã–lÃ¼m izni iÃ§in Ã¶zel akÄ±ÅŸ
            if (this.value === 'death') {
                documentField.style.display = 'none';
                relationshipField.style.display = 'block';
                relationshipDegree.required = true;
            } else {
                relationshipField.style.display = 'none';
                relationshipDegree.required = false;
                relationshipDegree.value = '';

                // DiÄŸer belge gerekli izinler iÃ§in
                if (documentRequiredTypes.includes(this.value)) {
                    documentField.style.display = 'block';
                    const hints = {
                        'sickness': 'SaÄŸlÄ±k raporu yÃ¼klemeniz gerekmektedir.',
                        'birth': 'DoÄŸum belgesi yÃ¼klemeniz gerekmektedir.',
                        'marriage': 'Evlilik cÃ¼zdanÄ± yÃ¼klemeniz gerekmektedir.'
                    };
                    documentHint.textContent = hints[this.value] || 'Gerekli belgeleri yÃ¼klemeniz gerekmektedir.';
                } else {
                    documentField.style.display = 'none';
                }
            }
        });

        // Ã–lÃ¼m izni iÃ§in tarihleri otomatik hesapla ve set et
        function autoSetDeathLeaveDates(startDate, allowedDays) {
            if (!startDate || !allowedDays) return;

            const start = new Date(startDate);

            // BitiÅŸ tarihini hesapla (baÅŸlangÄ±Ã§ + izin gÃ¼nleri - 1)
            const end = new Date(start);
            end.setDate(end.getDate() + allowedDays - 1);

            // Ä°ÅŸe dÃ¶nÃ¼ÅŸ tarihini hesapla (bitiÅŸ tarihi + 1, hafta sonu kontrolÃ¼ ile)
            const returnToWork = new Date(end);
            returnToWork.setDate(returnToWork.getDate() + 1);

            // Hafta sonu kontrolÃ¼ - Cumartesi ise Pazartesi'ye atla
            if (returnToWork.getDay() === 6) {
                returnToWork.setDate(returnToWork.getDate() + 2);
            }
            // Pazar ise Pazartesi'ye atla
            else if (returnToWork.getDay() === 0) {
                returnToWork.setDate(returnToWork.getDate() + 1);
            }

            // Tarihleri formatla (YYYY-MM-DD)
            const formatDateForInput = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            // Tarih alanlarÄ±nÄ± set et
            const endDateInput = document.getElementById('endDate');
            const returnToWorkInput = document.getElementById('returnToWorkDate');

            endDateInput.value = formatDateForInput(end);
            returnToWorkInput.value = formatDateForInput(returnToWork);

            // Flatpickr instance'larÄ±nÄ± gÃ¼ncelle
            if (endDatePicker) {
                endDatePicker.setDate(end, false);
            }
            if (returnToWorkDatePicker) {
                returnToWorkDatePicker.setDate(returnToWork, false);
            }

            // Ä°ÅŸ gÃ¼nÃ¼ sayÄ±sÄ±nÄ± gÃ¼ncelle
            updateLeaveDaysDisplay();

            // LokasyonlarÄ± yeniden render et (Ã§akÄ±ÅŸma kontrolÃ¼ iÃ§in)
            renderEmployeeLocations();
        }

        // Ã‡alÄ±ÅŸma yeri deÄŸiÅŸtiÄŸinde
        document.getElementById('workLocation').addEventListener('change', toggleSahaFields);

        // Eksik hizmet checkbox
        document.getElementById('noServiceGap').addEventListener('change', function() {
            const fields = document.getElementById('serviceGapFields');
            fields.style.display = this.checked ? 'none' : 'block';
        });

        // Flatpickr ile tarih seÃ§icileri baÅŸlat
        let startDatePicker, endDatePicker;

        startDatePicker = flatpickr("#startDate", {
            ...getFlatpickrConfig(),
            onChange: function(selectedDates, dateStr, instance) {
                // BitiÅŸ tarihinin minimum deÄŸerini gÃ¼ncelle
                if (endDatePicker && selectedDates[0]) {
                    endDatePicker.set('minDate', selectedDates[0]);
                }
                updateLeaveDaysDisplay();
                // LokasyonlarÄ± yeniden render et (Ã§akÄ±ÅŸma kontrolÃ¼ iÃ§in)
                renderEmployeeLocations();

                // Ã–lÃ¼m izni iÃ§in tarihleri otomatik hesapla
                const leaveType = document.getElementById('leaveType').value;
                if (leaveType === 'death') {
                    const relationshipDegree = document.getElementById('relationshipDegree').value;
                    if (relationshipDegree) {
                        const allowedDays = ['anne', 'baba', 'es', 'cocuk'].includes(relationshipDegree) ? 3 : 1;
                        autoSetDeathLeaveDates(dateStr, allowedDays);
                    }
                }
            }
        });

        endDatePicker = flatpickr("#endDate", {
            ...getFlatpickrConfig(),
            onChange: function(selectedDates, dateStr, instance) {
                // Ä°ÅŸe BaÅŸlangÄ±Ã§ Tarihi'nin minimum deÄŸerini gÃ¼ncelle
                if (returnToWorkDatePicker && selectedDates[0]) {
                    const nextDay = new Date(selectedDates[0]);
                    nextDay.setDate(nextDay.getDate() + 1);
                    returnToWorkDatePicker.set('minDate', nextDay);
                }
                updateLeaveDaysDisplay();
                // LokasyonlarÄ± yeniden render et (Ã§akÄ±ÅŸma kontrolÃ¼ iÃ§in)
                renderEmployeeLocations();
            }
        });

        // Ä°ÅŸe BaÅŸlangÄ±Ã§ Tarihi picker'Ä±
        let returnToWorkDatePicker = flatpickr("#returnToWorkDate", {
            ...getFlatpickrConfig(),
            onChange: function(selectedDates, dateStr, instance) {
                updateLeaveDaysDisplay();
            }
        });

        // YakÄ±nlÄ±k derecesi deÄŸiÅŸtiÄŸinde tarihleri otomatik hesapla
        // NOT: Flatpickr initialize edildikten SONRA eklenmeli
        document.getElementById('relationshipDegree').addEventListener('change', function() {
            const leaveType = document.getElementById('leaveType').value;
            if (leaveType !== 'death') return;

            // Flatpickr'dan seÃ§ili tarihi al
            if (!startDatePicker || !startDatePicker.selectedDates || startDatePicker.selectedDates.length === 0) {
                App.showNotification('LÃ¼tfen Ã¶nce baÅŸlangÄ±Ã§ tarihi seÃ§iniz.', 'warning');
                return;
            }

            const startDate = startDatePicker.selectedDates[0];
            const dateStr = startDate.getFullYear() + '-' +
                           String(startDate.getMonth() + 1).padStart(2, '0') + '-' +
                           String(startDate.getDate()).padStart(2, '0');

            const allowedDays = ['anne', 'baba', 'es', 'cocuk'].includes(this.value) ? 3 : 1;
            autoSetDeathLeaveDates(dateStr, allowedDays);
        });

        // Ä°ÅŸ gÃ¼nÃ¼ sayÄ±sÄ±nÄ± hesapla ve gÃ¶ster
        function updateLeaveDaysDisplay() {
            const startInput = document.getElementById('startDate');
            const returnToWorkInput = document.getElementById('returnToWorkDate');

            if (startInput.value && returnToWorkInput.value) {
                // Flatpickr'dan tarihleri al
                const startDate = startDatePicker.selectedDates[0];
                const returnToWorkDate = returnToWorkDatePicker.selectedDates[0];

                if (startDate && returnToWorkDate && startDate < returnToWorkDate) {
                    const workingDaysCount = calculateWorkingDays(startDate, returnToWorkDate);
                    document.getElementById('totalDays').value = workingDaysCount + ' iÅŸ gÃ¼nÃ¼';
                } else {
                    document.getElementById('totalDays').value = '0 iÅŸ gÃ¼nÃ¼';
                }
            }
        }

        // Form submit fonksiyonu
        function submitRequest(uploadedDocuments = []) {
            const leaveType = document.getElementById('leaveType').value;

            // SeÃ§ili hizmet firmalarÄ±nÄ± ve saat bilgilerini al
            const selectedCompaniesWithTime = [];
            document.querySelectorAll('.company-checkbox:checked').forEach(checkbox => {
                const company = checkbox.value;
                const startTime = document.querySelector(`.company-start-time[data-company="${company}"]`).value;
                const endTime = document.querySelector(`.company-end-time[data-company="${company}"]`).value;
                selectedCompaniesWithTime.push({
                    company: company,
                    startTime: startTime,
                    endTime: endTime
                });
            });

            // Ä°zin tarihleri ile Ã§akÄ±ÅŸan lokasyonlarÄ± bul
            const leaveStartDate = document.getElementById('startDate').value;
            const leaveEndDate = document.getElementById('endDate').value;
            const overlappingLocations = employeeLocationAssignments
                .filter(assignment => dateRangesOverlap(assignment.startDate, assignment.endDate, leaveStartDate, leaveEndDate))
                .map(assignment => {
                    const overlapInfo = getOverlapDates(assignment.startDate, assignment.endDate, leaveStartDate, leaveEndDate);
                    return {
                        locationKey: assignment.locationKey,
                        locationName: locations[assignment.locationKey].name,
                        locationCode: locations[assignment.locationKey].code,
                        projectName: locations[assignment.locationKey].projectName,
                        projectLeader: locations[assignment.locationKey].leader,
                        assignmentStartDate: assignment.startDate,
                        assignmentEndDate: assignment.endDate,
                        overlapStartDate: overlapInfo ? formatDateTR(overlapInfo.start) : null,
                        overlapEndDate: overlapInfo ? formatDateTR(overlapInfo.end) : null,
                        overlapDays: overlapInfo ? overlapInfo.days : 0
                    };
                });

            const requestData = {
                type: leaveType,
                startDate: leaveStartDate,
                endDate: leaveEndDate,
                returnToWorkDate: document.getElementById('returnToWorkDate').value,
                days: document.getElementById('totalDays').value,
                description: document.getElementById('description').value,
                workLocation: document.getElementById('workLocation').value,
                // Saha workflow additional fields
                employeeLocationAssignments: employeeLocationAssignments, // TÃ¼m gÃ¶revlendirmeler
                overlappingLocations: overlappingLocations, // Ä°zin tarihleri ile Ã§akÄ±ÅŸan lokasyonlar
                noServiceGap: document.getElementById('noServiceGap')?.checked || false,
                serviceCompanies: selectedCompaniesWithTime, // Firma adÄ± + saat bilgileri
                // Yeni: YÃ¼klenen dosyalar
                documents: uploadedDocuments,
                hasDocuments: uploadedDocuments.length > 0,
                // Mazeret izni iÃ§in saat bilgileri
                startTime: document.getElementById('startTime')?.value || '',
                endTime: document.getElementById('endTime')?.value || '',
                // Ã–lÃ¼m izni iÃ§in yakÄ±nlÄ±k derecesi
                relationshipDegree: leaveType === 'death' ? document.getElementById('relationshipDegree').value : null
            };

            // WorkflowEngine ile talep oluÅŸtur
            const request = WorkflowEngine.createRequest(requestData);

            if (request) {
                // Talebi kaydet
                WorkflowEngine.saveRequest(request);

                // Console'a workflow bilgilerini yazdÄ±r
                console.log('ğŸš€ Ä°ZÄ°N TALEBÄ° OLUÅTURULDU:');
                console.log('Talep ID:', request.id);
                console.log('Workflow AdÄ±mlarÄ±:', request.workflow.steps);
                console.log('GeÃ§erli AdÄ±m:', request.workflow.currentStep);
                console.log('YÃ¼klenen Belgeler:', uploadedDocuments.length);
                console.log('---');

                App.showNotification('Ä°zin talebiniz baÅŸarÄ±yla gÃ¶nderildi! Onay sÃ¼recine alÄ±ndÄ±.', 'success');
                setTimeout(() => window.location.href = 'izinlerim.html', 1500);
            } else {
                App.showNotification('Talep oluÅŸturulamadÄ±. LÃ¼tfen tekrar deneyin.', 'error');
            }
        }

        // Form submit
        document.getElementById('leaveRequestForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Dosya yÃ¼kleme kontrolÃ¼
            const documentUpload = document.getElementById('documentUpload');
            const leaveType = document.getElementById('leaveType').value;

            // Ã–lÃ¼m izni iÃ§in yakÄ±nlÄ±k derecesi kontrolÃ¼
            if (leaveType === 'death') {
                const relationshipDegree = document.getElementById('relationshipDegree').value;
                if (!relationshipDegree) {
                    App.showNotification('LÃ¼tfen yakÄ±nlÄ±k derecesi seÃ§iniz.', 'error');
                    return;
                }
            }

            if (documentRequiredTypes.includes(leaveType) && documentUpload.files.length > 0) {
                // DosyalarÄ± Base64 olarak oku ve kaydet
                const filePromises = [];
                for (let i = 0; i < documentUpload.files.length; i++) {
                    const file = documentUpload.files[i];
                    const promise = new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            resolve({
                                name: file.name,
                                size: file.size,
                                type: file.type,
                                uploadedAt: new Date().toISOString(),
                                data: e.target.result // Base64 data
                            });
                        };
                        reader.readAsDataURL(file);
                    });
                    filePromises.push(promise);
                }

                // TÃ¼m dosyalarÄ±n okunmasÄ±nÄ± bekle
                Promise.all(filePromises).then(files => {
                    submitRequest(files);
                });
            } else {
                // Dosya yok, direkt submit et
                submitRequest([]);
            }
        });
    </script>
</body>
</html>