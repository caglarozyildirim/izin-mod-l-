<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profilim - TEZ MEDƒ∞KAL</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .profile-header {
            background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%);
            color: white;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 32px;
            box-shadow: 0 4px 16px rgba(75, 159, 142, 0.3);
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        .profile-info h2 {
            margin: 0 0 8px 0;
            font-size: 28px;
            font-weight: 700;
        }

        .profile-meta {
            display: flex;
            gap: 24px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .profile-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .profile-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .profile-tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: #6b7280;
        }

        .profile-tab:hover {
            border-color: #4B9F8E;
            color: #4B9F8E;
        }

        .profile-tab.active {
            background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%);
            color: white;
            border-color: #4B9F8E;
        }

        .profile-content {
            display: none;
        }

        .profile-content.active {
            display: block;
        }

        .info-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .info-card-header {
            background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%);
            color: white;
            padding: 16px 20px;
            margin: -24px -24px 24px -24px;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            font-size: 18px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .info-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .info-label {
            font-weight: 600;
            color: #4B9F8E;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            color: #1f2937;
            font-size: 16px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 3px solid #4B9F8E;
        }

        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card-profile {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card-profile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient);
        }

        .stat-label-profile {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .stat-value-profile {
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, #4B9F8E 0%, #e5e7eb 100%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 32px;
        }

        .timeline-dot {
            position: absolute;
            left: -28px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            border: 3px solid #4B9F8E;
        }

        .timeline-content {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .timeline-date {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .timeline-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .timeline-desc {
            font-size: 14px;
            color: #6b7280;
        }

        /* Password Change Modal */
        .modal-backdrop-custom {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal-backdrop-custom.show {
            display: flex;
        }

        .modal-content-custom {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header-custom {
            background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%);
            color: white;
            padding: 20px 24px;
            border-radius: 16px 16px 0 0;
        }

        .modal-body-custom {
            padding: 24px;
        }

        .edit-mode .info-value {
            padding: 0;
            background: transparent;
            border: none;
        }

        .edit-mode .form-control {
            border-left: 3px solid #4B9F8E;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%);">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">
                <strong>TEZ MEDƒ∞KAL</strong> ƒ∞zin Y√∂netimi
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">üè† Anasayfa</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="yeni-talep.html">‚ûï Yeni Talep</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="takvim.html">üìÖ Takvim</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="profil.html">üë§ Profil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-action="logout">üö™ √áƒ±kƒ±≈ü</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4 mb-4">
        <div class="profile-container">
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-avatar">üë§</div>
                <div class="profile-info">
                    <h2 id="userName">Ahmet Yƒ±lmaz</h2>
                    <p style="margin: 0; opacity: 0.9; font-size: 16px;" id="userTitle">√úretim M√ºd√ºr√º</p>
                    <div class="profile-meta">
                        <div class="profile-meta-item">
                            <span>üÜî</span>
                            <span id="userEmployeeId">12345</span>
                        </div>
                        <div class="profile-meta-item">
                            <span>üè¢</span>
                            <span id="userDepartment">√úretim</span>
                        </div>
                        <div class="profile-meta-item">
                            <span>üìß</span>
                            <span id="userEmail">ahmet.yilmaz@tezmedical.com</span>
                        </div>
                        <div class="profile-meta-item">
                            <span>üì±</span>
                            <span id="userPhone">+90 532 111 22 33</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="profile-tabs">
                <div class="profile-tab active" onclick="switchTab('overview')">üìä Genel Bakƒ±≈ü</div>
                <div class="profile-tab" onclick="switchTab('personal')">üë§ Ki≈üisel Bilgiler</div>
                <div class="profile-tab" onclick="switchTab('leave-history')">üìã ƒ∞zin Ge√ßmi≈üi</div>
                <div class="profile-tab" onclick="switchTab('settings')">‚öôÔ∏è Ayarlar</div>
            </div>

            <!-- Overview Tab -->
            <div class="profile-content active" id="overview">
                <div class="stat-cards">
                    <div class="stat-card-profile" style="--gradient: linear-gradient(90deg, #4B9F8E 0%, #3a8070 100%);">
                        <div class="stat-label-profile">üìä Toplam ƒ∞zin Hakkƒ±</div>
                        <div class="stat-value-profile" id="totalLeave">20 G√ºn</div>
                    </div>
                    <div class="stat-card-profile" style="--gradient: linear-gradient(90deg, #FFC107 0%, #FFA000 100%);">
                        <div class="stat-label-profile">‚è±Ô∏è Kullanƒ±lan ƒ∞zin</div>
                        <div class="stat-value-profile" id="usedLeave">5 G√ºn</div>
                    </div>
                    <div class="stat-card-profile" style="--gradient: linear-gradient(90deg, #28A745 0%, #218838 100%);">
                        <div class="stat-label-profile">‚úÖ Kalan ƒ∞zin</div>
                        <div class="stat-value-profile" id="remainingLeave">15 G√ºn</div>
                    </div>
                    <div class="stat-card-profile" style="--gradient: linear-gradient(90deg, #17A2B8 0%, #138496 100%);">
                        <div class="stat-label-profile">üìù Toplam Talep</div>
                        <div class="stat-value-profile" id="totalRequests">8</div>
                    </div>
                </div>

                <div class="info-card">
                    <div class="info-card-header">üìà Son ƒ∞zin Aktiviteleri</div>
                    <div class="timeline" id="activityTimeline">
                        <!-- Timeline items will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Personal Info Tab -->
            <div class="profile-content" id="personal">
                <div class="info-card">
                    <div class="info-card-header">üë§ Ki≈üisel Bilgiler</div>
                    <div class="info-grid" id="personalInfoGrid">
                        <div class="info-field">
                            <div class="info-label">Ad Soyad</div>
                            <div class="info-value" id="fullName">Ahmet Yƒ±lmaz</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">Sicil No</div>
                            <div class="info-value" id="employeeId">12345</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">TC Kimlik No</div>
                            <div class="info-value" id="identityNo">***********</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">Doƒüum Tarihi</div>
                            <div class="info-value" id="birthDate">15.03.1985</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">E-posta</div>
                            <div class="info-value" id="email">ahmet.yilmaz@tezmedical.com</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">Telefon</div>
                            <div class="info-value" id="phone">+90 532 111 22 33</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="enableEdit()" style="background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%); border: none;">‚úèÔ∏è D√ºzenle</button>
                        <button class="btn btn-success" onclick="savePersonalInfo()" style="display: none;" id="saveBtn">üíæ Kaydet</button>
                        <button class="btn btn-secondary" onclick="cancelEdit()" style="display: none;" id="cancelBtn">‚ùå ƒ∞ptal</button>
                    </div>
                </div>

                <div class="info-card">
                    <div class="info-card-header">üè¢ ƒ∞≈ü Bilgileri</div>
                    <div class="info-grid">
                        <div class="info-field">
                            <div class="info-label">Departman</div>
                            <div class="info-value" id="department">√úretim</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">Pozisyon</div>
                            <div class="info-value" id="position">√úretim M√ºd√ºr√º</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">ƒ∞≈üe Ba≈ülama</div>
                            <div class="info-value" id="startDate">01.01.2015</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">√áalƒ±≈üma S√ºresi</div>
                            <div class="info-value" id="workDuration">10 Yƒ±l 11 Ay</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">Y√∂netici</div>
                            <div class="info-value" id="manager">Mehmet Demir</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">√áalƒ±≈üma ≈ûekli</div>
                            <div class="info-value" id="workType">Tam Zamanlƒ±</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leave History Tab -->
            <div class="profile-content" id="leave-history">
                <div class="info-card">
                    <div class="info-card-header">üìã Son ƒ∞zinlerim</div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead style="background: #f9fafb;">
                                <tr>
                                    <th>ƒ∞zin T√ºr√º</th>
                                    <th>Ba≈ülangƒ±√ß</th>
                                    <th>Biti≈ü</th>
                                    <th>S√ºre</th>
                                    <th>Durum</th>
                                    <th>Talep Tarihi</th>
                                </tr>
                            </thead>
                            <tbody id="leaveHistoryTable">
                                <!-- Will be filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="info-card">
                    <div class="info-card-header">üìä ƒ∞zin ƒ∞statistikleri</div>
                    <div class="info-grid">
                        <div class="info-field">
                            <div class="info-label">Bu Yƒ±l Kullanƒ±lan</div>
                            <div class="info-value" style="border-left-color: #FFC107;">5 G√ºn</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">Ge√ßen Yƒ±l Kullanƒ±lan</div>
                            <div class="info-value" style="border-left-color: #6b7280;">18 G√ºn</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">Onaylanan Talepler</div>
                            <div class="info-value" style="border-left-color: #28A745;">6 Adet</div>
                        </div>
                        <div class="info-field">
                            <div class="info-label">Reddedilen Talepler</div>
                            <div class="info-value" style="border-left-color: #DC3545;">2 Adet</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="profile-content" id="settings">
                <div class="info-card">
                    <div class="info-card-header">üîí G√ºvenlik</div>
                    <div class="info-field">
                        <div class="info-label">≈ûifre</div>
                        <div class="info-value">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-warning" onclick="showPasswordModal()">üîë ≈ûifre Deƒüi≈ütir</button>
                    </div>
                </div>

                <div class="info-card">
                    <div class="info-card-header">üîî Bildirim Tercihleri</div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="emailNotif" checked>
                        <label class="form-check-label" for="emailNotif">
                            E-posta bildirimleri
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="smsNotif">
                        <label class="form-check-label" for="smsNotif">
                            SMS bildirimleri
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="approvalNotif" checked>
                        <label class="form-check-label" for="approvalNotif">
                            Onay durumu bildirimleri
                        </label>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="saveNotificationSettings()" style="background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%); border: none;">üíæ Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div class="modal-backdrop-custom" id="passwordModal" onclick="closePasswordModal(event)">
        <div class="modal-content-custom" onclick="event.stopPropagation()">
            <div class="modal-header-custom">
                <h5 style="margin: 0;">üîë ≈ûifre Deƒüi≈ütir</h5>
            </div>
            <div class="modal-body-custom">
                <form id="passwordForm">
                    <div class="mb-3">
                        <label class="form-label">Mevcut ≈ûifre</label>
                        <input type="password" class="form-control" id="currentPassword" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Yeni ≈ûifre</label>
                        <input type="password" class="form-control" id="newPassword" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Yeni ≈ûifre (Tekrar)</label>
                        <input type="password" class="form-control" id="confirmPassword" required>
                    </div>
                    <div class="action-buttons" style="margin-top: 20px;">
                        <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #4B9F8E 0%, #3a8070 100%); border: none;">üíæ ≈ûifreyi Deƒüi≈ütir</button>
                        <button type="button" class="btn btn-secondary" onclick="closePasswordModal()">ƒ∞ptal</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        let originalData = {};

        // Initialize profile page
        function initProfile() {
            loadUserProfile();
            loadLeaveHistory();
            loadActivityTimeline();
        }

        // Load user profile
        function loadUserProfile() {
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const userData = JSON.parse(localStorage.getItem(`userData_${user.id}`) || '{}');

            // Header
            document.getElementById('userName').textContent = user.name || 'Kullanƒ±cƒ±';
            document.getElementById('userTitle').textContent = user.position || '-';
            document.getElementById('userEmployeeId').textContent = user.employeeId || '-';
            document.getElementById('userDepartment').textContent = user.department || '-';
            document.getElementById('userEmail').textContent = user.email || '-';
            document.getElementById('userPhone').textContent = user.phone || '-';

            // Overview stats
            const balance = userData.leaveBalance || { earned: 20, used: 5, remaining: 15 };
            document.getElementById('totalLeave').textContent = `${balance.earned} G√ºn`;
            document.getElementById('usedLeave').textContent = `${balance.used} G√ºn`;
            document.getElementById('remainingLeave').textContent = `${balance.remaining} G√ºn`;
            document.getElementById('totalRequests').textContent = (userData.leaveRequests || []).length;

            // Personal info
            document.getElementById('fullName').textContent = user.name || '-';
            document.getElementById('employeeId').textContent = user.employeeId || '-';
            document.getElementById('identityNo').textContent = user.identityNo || '***********';
            document.getElementById('birthDate').textContent = user.birthDate || '-';
            document.getElementById('email').textContent = user.email || '-';
            document.getElementById('phone').textContent = user.phone || '-';

            // Work info
            document.getElementById('department').textContent = user.department || '-';
            document.getElementById('position').textContent = user.position || '-';
            document.getElementById('startDate').textContent = user.startDate || '-';
            document.getElementById('workDuration').textContent = calculateWorkDuration(user.startDate);
            document.getElementById('manager').textContent = user.manager || '-';
            document.getElementById('workType').textContent = user.workType || 'Tam Zamanlƒ±';
        }

        // Calculate work duration
        function calculateWorkDuration(startDateStr) {
            if (!startDateStr) return '-';

            const startDate = new Date(startDateStr.split('.').reverse().join('-'));
            const today = new Date();

            const years = today.getFullYear() - startDate.getFullYear();
            const months = today.getMonth() - startDate.getMonth();

            const totalMonths = years * 12 + months;
            const finalYears = Math.floor(totalMonths / 12);
            const finalMonths = totalMonths % 12;

            return `${finalYears} Yƒ±l ${finalMonths} Ay`;
        }

        // Load leave history
        function loadLeaveHistory() {
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const userData = JSON.parse(localStorage.getItem(`userData_${user.id}`) || '{}');
            const requests = userData.leaveRequests || [];

            const table = document.getElementById('leaveHistoryTable');

            if (requests.length === 0) {
                table.innerHTML = '<tr><td colspan="6" class="text-center">Hen√ºz izin talebiniz bulunmamaktadƒ±r.</td></tr>';
                return;
            }

            const leaveTypes = {
                annual: 'Yƒ±llƒ±k ƒ∞zin',
                sick: 'Hastalƒ±k ƒ∞zni',
                excuse: 'Mazeret ƒ∞zni',
                unpaid: '√úcretsiz ƒ∞zin'
            };

            const statusBadges = {
                pending: '<span class="badge bg-warning">Beklemede</span>',
                approved: '<span class="badge bg-success">Onaylandƒ±</span>',
                rejected: '<span class="badge bg-danger">Reddedildi</span>',
                revision: '<span class="badge bg-info">Revizyon</span>'
            };

            table.innerHTML = requests.slice(0, 10).map(req => `
                <tr>
                    <td>${leaveTypes[req.type] || req.type}</td>
                    <td>${App.formatDate(req.startDate)}</td>
                    <td>${App.formatDate(req.endDate)}</td>
                    <td>${App.calculateDays(req.startDate, req.endDate)} g√ºn</td>
                    <td>${statusBadges[req.status] || req.status}</td>
                    <td>${App.formatDate(req.requestDate)}</td>
                </tr>
            `).join('');
        }

        // Load activity timeline
        function loadActivityTimeline() {
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const userData = JSON.parse(localStorage.getItem(`userData_${user.id}`) || '{}');
            const requests = (userData.leaveRequests || []).slice(0, 5);

            const timeline = document.getElementById('activityTimeline');

            if (requests.length === 0) {
                timeline.innerHTML = '<p class="text-center text-muted">Hen√ºz aktivite bulunmamaktadƒ±r.</p>';
                return;
            }

            const statusTexts = {
                pending: 'ƒ∞zin talebi olu≈üturuldu ve onay bekliyor',
                approved: 'ƒ∞zin talebi onaylandƒ±',
                rejected: 'ƒ∞zin talebi reddedildi',
                revision: 'ƒ∞zin talebi revizyon i√ßin geri g√∂nderildi'
            };

            timeline.innerHTML = requests.map(req => `
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div class="timeline-date">${App.formatDate(req.requestDate)}</div>
                        <div class="timeline-title">${req.type === 'annual' ? 'Yƒ±llƒ±k ƒ∞zin' : req.type === 'sick' ? 'Hastalƒ±k ƒ∞zni' : req.type === 'excuse' ? 'Mazeret ƒ∞zni' : '√úcretsiz ƒ∞zin'}</div>
                        <div class="timeline-desc">${statusTexts[req.status] || req.status} (${App.calculateDays(req.startDate, req.endDate)} g√ºn)</div>
                    </div>
                </div>
            `).join('');
        }

        // Switch tabs
        function switchTab(tabName) {
            // Hide all contents
            document.querySelectorAll('.profile-content').forEach(content => {
                content.classList.remove('active');
            });

            // Deactivate all tabs
            document.querySelectorAll('.profile-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected content and activate tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Enable edit mode
        function enableEdit() {
            const grid = document.getElementById('personalInfoGrid');
            grid.classList.add('edit-mode');

            // Convert values to inputs (excluding read-only fields)
            const editableFields = ['fullName', 'email', 'phone'];

            editableFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                const value = element.textContent;
                element.innerHTML = `<input type="text" class="form-control" value="${value}">`;
            });

            // Store original data
            originalData = {
                fullName: document.querySelector('#fullName input').value,
                email: document.querySelector('#email input').value,
                phone: document.querySelector('#phone input').value
            };

            // Show save/cancel buttons
            document.getElementById('saveBtn').style.display = 'inline-block';
            document.getElementById('cancelBtn').style.display = 'inline-block';
            event.target.style.display = 'none';
        }

        // Save personal info
        function savePersonalInfo() {
            const newData = {
                fullName: document.querySelector('#fullName input').value,
                email: document.querySelector('#email input').value,
                phone: document.querySelector('#phone input').value
            };

            // Update user data in localStorage
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            user.name = newData.fullName;
            user.email = newData.email;
            user.phone = newData.phone;
            localStorage.setItem('currentUser', JSON.stringify(user));

            App.showNotification('Bilgileriniz ba≈üarƒ±yla g√ºncellendi!', 'success');

            // Reload profile
            cancelEdit();
            loadUserProfile();
        }

        // Cancel edit
        function cancelEdit() {
            const grid = document.getElementById('personalInfoGrid');
            grid.classList.remove('edit-mode');

            // Restore original values
            document.getElementById('fullName').textContent = originalData.fullName || document.getElementById('fullName').textContent;
            document.getElementById('email').textContent = originalData.email || document.getElementById('email').textContent;
            document.getElementById('phone').textContent = originalData.phone || document.getElementById('phone').textContent;

            // Hide save/cancel buttons
            document.getElementById('saveBtn').style.display = 'none';
            document.getElementById('cancelBtn').style.display = 'none';
            document.querySelector('.action-buttons .btn-primary').style.display = 'inline-block';
        }

        // Show password modal
        function showPasswordModal() {
            document.getElementById('passwordModal').classList.add('show');
        }

        // Close password modal
        function closePasswordModal(event) {
            if (!event || event.target.id === 'passwordModal') {
                document.getElementById('passwordModal').classList.remove('show');
                document.getElementById('passwordForm').reset();
            }
        }

        // Handle password form
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (newPass !== confirm) {
                App.showNotification('Yeni ≈üifreler e≈üle≈ümiyor!', 'warning');
                return;
            }

            if (newPass.length < 6) {
                App.showNotification('≈ûifre en az 6 karakter olmalƒ±dƒ±r!', 'warning');
                return;
            }

            // In real app, this would call an API
            App.showNotification('≈ûifreniz ba≈üarƒ±yla deƒüi≈ütirildi!', 'success');
            closePasswordModal();
        });

        // Save notification settings
        function saveNotificationSettings() {
            const settings = {
                email: document.getElementById('emailNotif').checked,
                sms: document.getElementById('smsNotif').checked,
                approval: document.getElementById('approvalNotif').checked
            };

            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            user.notificationSettings = settings;
            localStorage.setItem('currentUser', JSON.stringify(user));

            App.showNotification('Bildirim tercihleri kaydedildi!', 'success');
        }

        // Initialize on load
        initProfile();
    </script>
</body>
</html>