<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TÃ¼m Ä°zinler - Tez Medikal</title>
    <link rel="stylesheet" href="css/design-system.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">
            <div style="width: 40px; height: 40px; background: var(--primary); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">TM</div>
            <span>Tez Medikal</span>
        </div>
        <div class="navbar-menu">
            <a href="dashboard.html" class="nav-link">Dashboard</a>
            <a href="onay-yonetimi.html" class="nav-link">Onay Bekleyenler</a>
            <a href="tum-izinler.html" class="nav-link active">TÃ¼m Ä°zinler</a>
            <a href="raporlar.html" class="nav-link">Raporlar</a>
        </div>
        <div class="navbar-user">
            <div class="user-info">
                <div class="user-name" id="userName">-</div>
                <div class="user-role" id="userRole">-</div>
            </div>
            <div class="user-avatar" id="userAvatar">-</div>
            <button class="btn btn-ghost btn-sm" data-action="logout">Ã‡Ä±kÄ±ÅŸ</button>
        </div>
    </nav>

    <main class="main-content">
        <div class="container-fluid">
            <div class="page-header">
                <h1 class="page-title">TÃ¼m Ä°zin Talepleri</h1>
                <p class="page-subtitle">TÃ¼m Ã§alÄ±ÅŸanlarÄ±n izin taleplerini gÃ¶rÃ¼ntÃ¼leyin</p>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-4 mb-5">
                <!-- Toplam Talep - Stacked Documents Icon -->
                <div class="stat-card">
                    <div class="stat-label">Toplam Talep</div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px;">
                        <div class="stat-value" id="totalRequests">156</div>
                        <svg width="60" height="60" viewBox="0 0 60 60" style="margin-right: 8px;">
                            <!-- Layer 3 (Back) -->
                            <rect x="22" y="14" width="28" height="36" rx="3" fill="#e0e7ff" opacity="0.4" style="animation: layer-slide 2s ease-in-out infinite; animation-delay: 0.4s;"/>
                            <!-- Layer 2 (Middle) -->
                            <rect x="18" y="10" width="28" height="36" rx="3" fill="#c7d2fe" opacity="0.6" style="animation: layer-slide 2s ease-in-out infinite; animation-delay: 0.2s;"/>
                            <!-- Layer 1 (Front) -->
                            <g style="animation: layer-slide 2s ease-in-out infinite;">
                                <rect x="14" y="6" width="28" height="36" rx="3" fill="#6366f1" stroke="#4f46e5" stroke-width="2"/>
                                <line x1="18" y1="14" x2="34" y2="14" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                <line x1="18" y1="20" x2="38" y2="20" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                <line x1="18" y1="26" x2="32" y2="26" stroke="white" stroke-width="2" stroke-linecap="round"/>
                            </g>
                        </svg>
                    </div>
                    <div class="stat-subtitle">TÃ¼m Zamanlar</div>
                </div>

                <!-- Onaylanan - Donut Chart -->
                <div class="stat-card success">
                    <div class="stat-label">Onaylanan</div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px;">
                        <div class="stat-value" id="approvedRequests">132</div>
                        <svg width="60" height="60" viewBox="0 0 60 60" style="margin-right: 8px; transform: rotate(-90deg);">
                            <!-- Background Circle -->
                            <circle cx="30" cy="30" r="20" fill="none" stroke="#e0f2e9" stroke-width="8"/>
                            <!-- Progress Circle (84.6%) -->
                            <circle cx="30" cy="30" r="20" fill="none" stroke="#10b981" stroke-width="8"
                                    stroke-dasharray="126" stroke-dashoffset="19.4"
                                    stroke-linecap="round"
                                    style="animation: fill-donut 1.5s ease-out forwards;"/>
                            <!-- Center Text -->
                            <text x="30" y="35" text-anchor="middle" fill="#10b981" font-size="12" font-weight="bold" transform="rotate(90 30 30)">84.6%</text>
                        </svg>
                    </div>
                    <div class="stat-subtitle">%84.6</div>
                </div>

                <!-- Bekleyen - Circular Progress Ring with Pulse -->
                <div class="stat-card warning">
                    <div class="stat-label">Bekleyen</div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px;">
                        <div class="stat-value" id="pendingRequests">8</div>
                        <svg width="60" height="60" viewBox="0 0 60 60" style="margin-right: 8px; transform: rotate(-90deg);">
                            <!-- Background Circle -->
                            <circle cx="30" cy="30" r="22" fill="none" stroke="#fef3c7" stroke-width="4"/>
                            <!-- Pulsing Ring (5.1%) -->
                            <circle cx="30" cy="30" r="22" fill="none" stroke="#f59e0b" stroke-width="4"
                                    stroke-dasharray="138" stroke-dashoffset="131"
                                    stroke-linecap="round"
                                    style="animation: pulse-ring 2s ease-in-out infinite;"/>
                            <!-- Center Dot -->
                            <circle cx="30" cy="30" r="8" fill="#f59e0b" style="animation: pop-in 0.6s ease-out;"/>
                            <!-- Center Text -->
                            <text x="30" y="35" text-anchor="middle" fill="white" font-size="10" font-weight="bold" transform="rotate(90 30 30)">5.1%</text>
                        </svg>
                    </div>
                    <div class="stat-subtitle">%5.1</div>
                </div>

                <!-- Reddedilen - Mini Bar Chart -->
                <div class="stat-card danger">
                    <div class="stat-label">Reddedilen</div>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px;">
                        <div class="stat-value" id="rejectedRequests">16</div>
                        <svg width="60" height="60" viewBox="0 0 60 60" style="margin-right: 8px;">
                            <!-- Bar Chart Background -->
                            <rect x="10" y="10" width="40" height="40" rx="4" fill="#fef2f2"/>

                            <!-- Bars -->
                            <g style="animation: fade-in-up 0.8s ease-out;">
                                <!-- Bar 1 (100%) -->
                                <rect x="14" y="18" width="6" height="28" rx="2" fill="#fecaca">
                                    <animate attributeName="height" from="0" to="28" dur="0.8s" fill="freeze"/>
                                    <animate attributeName="y" from="46" to="18" dur="0.8s" fill="freeze"/>
                                </rect>
                                <!-- Bar 2 (65%) -->
                                <rect x="23" y="28" width="6" height="18" rx="2" fill="#fca5a5">
                                    <animate attributeName="height" from="0" to="18" dur="0.8s" begin="0.1s" fill="freeze"/>
                                    <animate attributeName="y" from="46" to="28" dur="0.8s" begin="0.1s" fill="freeze"/>
                                </rect>
                                <!-- Bar 3 (40%) - Highlighted (10.3%) -->
                                <rect x="32" y="35" width="6" height="11" rx="2" fill="#ef4444">
                                    <animate attributeName="height" from="0" to="11" dur="0.8s" begin="0.2s" fill="freeze"/>
                                    <animate attributeName="y" from="46" to="35" dur="0.8s" begin="0.2s" fill="freeze"/>
                                </rect>
                                <!-- Bar 4 (25%) -->
                                <rect x="41" y="39" width="6" height="7" rx="2" fill="#fca5a5">
                                    <animate attributeName="height" from="0" to="7" dur="0.8s" begin="0.3s" fill="freeze"/>
                                    <animate attributeName="y" from="46" to="39" dur="0.8s" begin="0.3s" fill="freeze"/>
                                </rect>
                            </g>

                            <!-- 10.3% Label -->
                            <text x="30" y="54" text-anchor="middle" fill="#ef4444" font-size="10" font-weight="bold" style="animation: fade-in-up 0.8s ease-out 0.5s both;">10.3%</text>
                        </svg>
                    </div>
                    <div class="stat-subtitle">%10.3</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
                <div class="card-body" style="padding: 16px;">
                    <div style="display: grid; grid-template-columns: 2fr 1.2fr 1fr 1fr auto; gap: 12px; align-items: center;">
                        <div>
                            <input list="employeeList" class="form-control" placeholder="Ã‡alÄ±ÅŸan seÃ§in veya arayÄ±n..." id="searchEmployee" oninput="filterRequests()">
                            <datalist id="employeeList">
                                <option value="Ahmet YÄ±lmaz - Ãœretim">
                                <option value="Fatma Kaya - Muhasebe">
                                <option value="Mehmet Demir - IT">
                                <option value="AyÅŸe Åahin - SatÄ±ÅŸ">
                                <option value="Can KÄ±lÄ±Ã§ - Ãœretim">
                                <option value="Elif Ã–z - Muhasebe">
                                <option value="Ali YÄ±ldÄ±z - IT">
                                <option value="Zeynep Arslan - SatÄ±ÅŸ">
                            </datalist>
                        </div>
                        <div>
                            <select class="form-control form-select" id="statusFilter" onchange="filterRequests()">
                                <option value="">TÃ¼m Durumlar</option>
                                <option value="pending">Beklemede</option>
                                <option value="approved">OnaylandÄ±</option>
                                <option value="rejected">Reddedildi</option>
                            </select>
                        </div>
                        <div>
                            <input type="date" class="form-control" id="startDateFilter" onchange="filterRequests()" placeholder="BaÅŸlangÄ±Ã§">
                        </div>
                        <div>
                            <input type="date" class="form-control" id="endDateFilter" onchange="filterRequests()" placeholder="BitiÅŸ">
                        </div>
                        <div style="color: var(--text-tertiary); font-size: 14px; white-space: nowrap; padding: 0 12px;">
                            <span id="filterResultCount">14 talep</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- All Requests Table -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Ä°zin Talepleri</h3>
                    <div class="flex gap-md">
                        <button class="btn btn-sm btn-success" onclick="exportExcel()">ğŸ“¥ Excel</button>
                        <button class="btn btn-sm btn-secondary" onclick="exportPDF()">ğŸ“„ PDF</button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Talep No</th>
                                <th>Ã‡alÄ±ÅŸan</th>
                                <th>Departman</th>
                                <th>Ä°zin Tipi</th>
                                <th>BaÅŸlangÄ±Ã§</th>
                                <th>BitiÅŸ</th>
                                <th>GÃ¼n</th>
                                <th>Durum</th>
                                <th id="documentColumn" style="display: none;">Evrak</th>
                                <th>Talep Tarihi</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody id="requestsTable">
                            <!-- Mock Data - 15 Ã–rnek Talep -->
                            <tr data-status="approved" data-employee="Ahmet YÄ±lmaz" data-department="Ãœretim" data-start="2025-11-10">
                                <td><strong>REQ-001</strong></td>
                                <td>Ahmet YÄ±lmaz</td>
                                <td>Ãœretim</td>
                                <td>YÄ±llÄ±k Ä°zin</td>
                                <td>10.11.2025</td>
                                <td>15.11.2025</td>
                                <td>5 gÃ¼n</td>
                                <td><span class="badge badge-success">OnaylandÄ±</span></td>
                                <td>03.11.2025</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-001', 'Ahmet YÄ±lmaz', 'Ãœretim', 'YÄ±llÄ±k Ä°zin', '10.11.2025', '15.11.2025', '5 gÃ¼n', 'approved', 'Aile ziyareti')">ğŸ‘ Detay</button>
                                </td>
                            </tr>
                            <tr data-status="pending" data-employee="Fatma Kaya" data-department="Muhasebe" data-start="2025-11-06">
                                <td><strong>REQ-002</strong></td>
                                <td>Fatma Kaya</td>
                                <td>Muhasebe</td>
                                <td>Mazeret Ä°zni</td>
                                <td>06.11.2025</td>
                                <td>06.11.2025</td>
                                <td>4 saat</td>
                                <td><span class="badge badge-warning">Beklemede</span></td>
                                <td>04.11.2025</td>
                                <td>
                                    <div class="flex gap-sm">
                                        <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-002', 'Fatma Kaya', 'Muhasebe', 'Mazeret Ä°zni', '06.11.2025', '06.11.2025', '4 saat', 'pending', 'Doktor randevusu')">ğŸ‘ Detay</button>
                                        <button class="btn btn-sm btn-success" onclick="approveRequest('REQ-002', 'Fatma Kaya', this)">âœ“ Onayla</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectRequest('REQ-002', 'Fatma Kaya', this)">âœ• Reddet</button>
                                        <button class="btn btn-sm btn-warning" onclick="reviseRequest('REQ-002', 'Fatma Kaya', this)">ğŸ”„ Revize</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="approved" data-employee="Mehmet Demir" data-department="IT" data-start="2025-10-28">
                                <td><strong>REQ-003</strong></td>
                                <td>Mehmet Demir</td>
                                <td>IT</td>
                                <td>HastalÄ±k Ä°zni</td>
                                <td>28.10.2025</td>
                                <td>30.10.2025</td>
                                <td>3 gÃ¼n</td>
                                <td><span class="badge badge-success">OnaylandÄ±</span></td>
                                <td>27.10.2025</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-003', 'Mehmet Demir', 'IT', 'HastalÄ±k Ä°zni', '28.10.2025', '30.10.2025', '3 gÃ¼n', 'approved', 'Grip tedavisi')">ğŸ‘ Detay</button>
                                </td>
                            </tr>
                            <tr data-status="rejected" data-employee="AyÅŸe Åahin" data-department="SatÄ±ÅŸ" data-start="2025-11-08">
                                <td><strong>REQ-004</strong></td>
                                <td>AyÅŸe Åahin</td>
                                <td>SatÄ±ÅŸ</td>
                                <td>YÄ±llÄ±k Ä°zin</td>
                                <td>08.11.2025</td>
                                <td>10.11.2025</td>
                                <td>3 gÃ¼n</td>
                                <td><span class="badge badge-danger">Reddedildi</span></td>
                                <td>01.11.2025</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-004', 'AyÅŸe Åahin', 'SatÄ±ÅŸ', 'YÄ±llÄ±k Ä°zin', '08.11.2025', '10.11.2025', '3 gÃ¼n', 'rejected', 'KiÅŸisel sebep', 'Departmanda yoÄŸunluk var')">ğŸ‘ Detay</button>
                                </td>
                            </tr>
                            <tr data-status="approved" data-employee="Can KÄ±lÄ±Ã§" data-department="Ãœretim" data-start="2025-12-20">
                                <td><strong>REQ-005</strong></td>
                                <td>Can KÄ±lÄ±Ã§</td>
                                <td>Ãœretim</td>
                                <td>YÄ±llÄ±k Ä°zin</td>
                                <td>20.12.2025</td>
                                <td>27.12.2025</td>
                                <td>7 gÃ¼n</td>
                                <td><span class="badge badge-success">OnaylandÄ±</span></td>
                                <td>15.11.2025</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-005', 'Can KÄ±lÄ±Ã§', 'Ãœretim', 'YÄ±llÄ±k Ä°zin', '20.12.2025', '27.12.2025', '7 gÃ¼n', 'approved', 'YÄ±lbaÅŸÄ± tatili')">ğŸ‘ Detay</button>
                                </td>
                            </tr>
                            <tr data-status="pending" data-employee="Elif Ã–z" data-department="Muhasebe" data-start="2025-11-12">
                                <td><strong>REQ-006</strong></td>
                                <td>Elif Ã–z</td>
                                <td>Muhasebe</td>
                                <td>EÄŸitim Ä°zni</td>
                                <td>12.11.2025</td>
                                <td>14.11.2025</td>
                                <td>3 gÃ¼n</td>
                                <td><span class="badge badge-warning">Beklemede</span></td>
                                <td>05.11.2025</td>
                                <td>
                                    <div class="flex gap-sm">
                                        <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-006', 'Elif Ã–z', 'Muhasebe', 'EÄŸitim Ä°zni', '12.11.2025', '14.11.2025', '3 gÃ¼n', 'pending', 'Muhasebe eÄŸitimi')">ğŸ‘ Detay</button>
                                        <button class="btn btn-sm btn-success" onclick="approveRequest('REQ-006', 'Elif Ã–z', this)">âœ“ Onayla</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectRequest('REQ-006', 'Elif Ã–z', this)">âœ• Reddet</button>
                                        <button class="btn btn-sm btn-warning" onclick="reviseRequest('REQ-006', 'Elif Ã–z', this)">ğŸ”„ Revize</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="approved" data-employee="Ali YÄ±ldÄ±z" data-department="IT" data-start="2025-09-15">
                                <td><strong>REQ-007</strong></td>
                                <td>Ali YÄ±ldÄ±z</td>
                                <td>IT</td>
                                <td>YÄ±llÄ±k Ä°zin</td>
                                <td>15.09.2025</td>
                                <td>20.09.2025</td>
                                <td>5 gÃ¼n</td>
                                <td><span class="badge badge-success">OnaylandÄ±</span></td>
                                <td>01.09.2025</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-007', 'Ali YÄ±ldÄ±z', 'IT', 'YÄ±llÄ±k Ä°zin', '15.09.2025', '20.09.2025', '5 gÃ¼n', 'approved', 'Tatil planÄ±')">ğŸ‘ Detay</button>
                                </td>
                            </tr>
                            <tr data-status="approved" data-employee="Zeynep Arslan" data-department="SatÄ±ÅŸ" data-start="2025-08-05">
                                <td><strong>REQ-008</strong></td>
                                <td>Zeynep Arslan</td>
                                <td>SatÄ±ÅŸ</td>
                                <td>Evlilik Ä°zni</td>
                                <td>05.08.2025</td>
                                <td>09.08.2025</td>
                                <td>5 gÃ¼n</td>
                                <td><span class="badge badge-success">OnaylandÄ±</span></td>
                                <td>15.07.2025</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-008', 'Zeynep Arslan', 'SatÄ±ÅŸ', 'Evlilik Ä°zni', '05.08.2025', '09.08.2025', '5 gÃ¼n', 'approved', 'Evlilik tÃ¶reni')">ğŸ‘ Detay</button>
                                </td>
                            </tr>
                            <tr data-status="pending" data-employee="Ahmet YÄ±lmaz" data-department="Ãœretim" data-start="2025-11-10">
                                <td><strong>REQ-009</strong></td>
                                <td>Ahmet YÄ±lmaz</td>
                                <td>Ãœretim</td>
                                <td>YÄ±llÄ±k Ä°zin</td>
                                <td>10.11.2025</td>
                                <td>15.11.2025</td>
                                <td>5 gÃ¼n</td>
                                <td><span class="badge badge-warning">Beklemede</span></td>
                                <td>03.11.2025</td>
                                <td>
                                    <div class="flex gap-sm">
                                        <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-009', 'Ahmet YÄ±lmaz', 'Ãœretim', 'YÄ±llÄ±k Ä°zin', '10.11.2025', '15.11.2025', '5 gÃ¼n', 'pending', 'Aile ziyareti')">ğŸ‘ Detay</button>
                                        <button class="btn btn-sm btn-success" onclick="approveRequest('REQ-009', 'Ahmet YÄ±lmaz', this)">âœ“ Onayla</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectRequest('REQ-009', 'Ahmet YÄ±lmaz', this)">âœ• Reddet</button>
                                        <button class="btn btn-sm btn-warning" onclick="reviseRequest('REQ-009', 'Ahmet YÄ±lmaz', this)">ğŸ”„ Revize</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="pending" data-employee="Mehmet Demir" data-department="IT" data-start="2025-11-18">
                                <td><strong>REQ-010</strong></td>
                                <td>Mehmet Demir</td>
                                <td>IT</td>
                                <td>YÄ±llÄ±k Ä°zin</td>
                                <td>18.11.2025</td>
                                <td>22.11.2025</td>
                                <td>5 gÃ¼n</td>
                                <td><span class="badge badge-warning">Beklemede</span></td>
                                <td>07.11.2025</td>
                                <td>
                                    <div class="flex gap-sm">
                                        <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-010', 'Mehmet Demir', 'IT', 'YÄ±llÄ±k Ä°zin', '18.11.2025', '22.11.2025', '5 gÃ¼n', 'pending', 'KiÅŸisel iÅŸler')">ğŸ‘ Detay</button>
                                        <button class="btn btn-sm btn-success" onclick="approveRequest('REQ-010', 'Mehmet Demir', this)">âœ“ Onayla</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectRequest('REQ-010', 'Mehmet Demir', this)">âœ• Reddet</button>
                                        <button class="btn btn-sm btn-warning" onclick="reviseRequest('REQ-010', 'Mehmet Demir', this)">ğŸ”„ Revize</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="pending" data-employee="Can KÄ±lÄ±Ã§" data-department="Ãœretim" data-start="2025-12-20">
                                <td><strong>REQ-011</strong></td>
                                <td>Can KÄ±lÄ±Ã§</td>
                                <td>Ãœretim</td>
                                <td>YÄ±llÄ±k Ä°zin</td>
                                <td>20.12.2025</td>
                                <td>27.12.2025</td>
                                <td>7 gÃ¼n</td>
                                <td><span class="badge badge-warning">Beklemede</span></td>
                                <td>15.11.2025</td>
                                <td>
                                    <div class="flex gap-sm">
                                        <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-011', 'Can KÄ±lÄ±Ã§', 'Ãœretim', 'YÄ±llÄ±k Ä°zin', '20.12.2025', '27.12.2025', '7 gÃ¼n', 'pending', 'YÄ±lbaÅŸÄ± tatili')">ğŸ‘ Detay</button>
                                        <button class="btn btn-sm btn-success" onclick="approveRequest('REQ-011', 'Can KÄ±lÄ±Ã§', this)">âœ“ Onayla</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectRequest('REQ-011', 'Can KÄ±lÄ±Ã§', this)">âœ• Reddet</button>
                                        <button class="btn btn-sm btn-warning" onclick="reviseRequest('REQ-011', 'Can KÄ±lÄ±Ã§', this)">ğŸ”„ Revize</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="pending" data-employee="Ali YÄ±ldÄ±z" data-department="IT" data-start="2025-11-08">
                                <td><strong>REQ-012</strong></td>
                                <td>Ali YÄ±ldÄ±z</td>
                                <td>IT</td>
                                <td>HastalÄ±k Ä°zni</td>
                                <td>08.11.2025</td>
                                <td>09.11.2025</td>
                                <td>2 gÃ¼n</td>
                                <td><span class="badge badge-warning">Beklemede</span></td>
                                <td>07.11.2025</td>
                                <td>
                                    <div class="flex gap-sm">
                                        <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-012', 'Ali YÄ±ldÄ±z', 'IT', 'HastalÄ±k Ä°zni', '08.11.2025', '09.11.2025', '2 gÃ¼n', 'pending', 'SoÄŸuk algÄ±nlÄ±ÄŸÄ±')">ğŸ‘ Detay</button>
                                        <button class="btn btn-sm btn-success" onclick="approveRequest('REQ-012', 'Ali YÄ±ldÄ±z', this)">âœ“ Onayla</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectRequest('REQ-012', 'Ali YÄ±ldÄ±z', this)">âœ• Reddet</button>
                                        <button class="btn btn-sm btn-warning" onclick="reviseRequest('REQ-012', 'Ali YÄ±ldÄ±z', this)">ğŸ”„ Revize</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="pending" data-employee="AyÅŸe Åahin" data-department="SatÄ±ÅŸ" data-start="2025-11-25">
                                <td><strong>REQ-013</strong></td>
                                <td>AyÅŸe Åahin</td>
                                <td>SatÄ±ÅŸ</td>
                                <td>YÄ±llÄ±k Ä°zin</td>
                                <td>25.11.2025</td>
                                <td>29.11.2025</td>
                                <td>5 gÃ¼n</td>
                                <td><span class="badge badge-warning">Beklemede</span></td>
                                <td>10.11.2025</td>
                                <td>
                                    <div class="flex gap-sm">
                                        <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-013', 'AyÅŸe Åahin', 'SatÄ±ÅŸ', 'YÄ±llÄ±k Ä°zin', '25.11.2025', '29.11.2025', '5 gÃ¼n', 'pending', 'Tatil planÄ±')">ğŸ‘ Detay</button>
                                        <button class="btn btn-sm btn-success" onclick="approveRequest('REQ-013', 'AyÅŸe Åahin', this)">âœ“ Onayla</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectRequest('REQ-013', 'AyÅŸe Åahin', this)">âœ• Reddet</button>
                                        <button class="btn btn-sm btn-warning" onclick="reviseRequest('REQ-013', 'AyÅŸe Åahin', this)">ğŸ”„ Revize</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-status="pending" data-employee="Hasan Ã‡elik" data-department="Ãœretim" data-start="2025-11-15">
                                <td><strong>REQ-014</strong></td>
                                <td>Hasan Ã‡elik</td>
                                <td>Ãœretim</td>
                                <td>Evlilik Ä°zni</td>
                                <td>15.11.2025</td>
                                <td>17.11.2025</td>
                                <td>3 gÃ¼n</td>
                                <td><span class="badge badge-warning">Beklemede</span></td>
                                <td>08.11.2025</td>
                                <td>
                                    <div class="flex gap-sm">
                                        <button class="btn btn-sm btn-secondary" onclick="showDetail('REQ-014', 'Hasan Ã‡elik', 'Ãœretim', 'Evlilik Ä°zni', '15.11.2025', '17.11.2025', '3 gÃ¼n', 'pending', 'DÃ¼ÄŸÃ¼n tÃ¶reni')">ğŸ‘ Detay</button>
                                        <button class="btn btn-sm btn-success" onclick="approveRequest('REQ-014', 'Hasan Ã‡elik', this)">âœ“ Onayla</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectRequest('REQ-014', 'Hasan Ã‡elik', this)">âœ• Reddet</button>
                                        <button class="btn btn-sm btn-warning" onclick="reviseRequest('REQ-014', 'Hasan Ã‡elik', this)">ğŸ”„ Revize</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="card-footer">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span id="resultCount">14 talep gÃ¶steriliyor</span>
                        <div class="flex gap-md">
                            <button class="btn btn-sm btn-secondary">â† Ã–nceki</button>
                            <span style="padding: 8px 16px;">Sayfa 1 / 1</span>
                            <button class="btn btn-sm btn-secondary">Sonraki â†’</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Reject Modal -->
    <div id="rejectModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; max-width: 600px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s ease-out;" onclick="event.stopPropagation()">
            <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 24px; border-radius: 16px 16px 0 0;">
                <h4 style="margin: 0; font-size: 20px; font-weight: 600;">âŒ Ä°zin Talebini Reddet</h4>
            </div>
            <div style="padding: 24px;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; color: #1f2937; margin-bottom: 8px; font-size: 14px;">
                        <span id="rejectEmployeeName"></span> iÃ§in red sebebini girin:
                    </label>
                    <textarea id="rejectReason" rows="6" style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; font-family: inherit; resize: vertical; min-height: 120px; line-height: 1.6;" placeholder="Red sebebini detaylÄ± olarak aÃ§Ä±klayÄ±n..."></textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeRejectModal()" style="padding: 12px 24px; border: none; border-radius: 8px; background: #e5e7eb; color: #1f2937; font-weight: 600; cursor: pointer; font-size: 14px;">Ä°ptal</button>
                    <button onclick="confirmReject()" style="padding: 12px 24px; border: none; border-radius: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; font-weight: 600; cursor: pointer; font-size: 14px; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);">Tamam</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Revise Modal -->
    <div id="reviseModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; max-width: 600px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s ease-out;" onclick="event.stopPropagation()">
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 24px; border-radius: 16px 16px 0 0;">
                <h4 style="margin: 0; font-size: 20px; font-weight: 600;">ğŸ”„ Revizyon Talebi</h4>
            </div>
            <div style="padding: 24px;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; color: #1f2937; margin-bottom: 4px; font-size: 14px;">
                        <span id="reviseEmployeeName"></span> iÃ§in revize notunu girin:
                    </label>
                    <div style="font-size: 13px; color: #6b7280; margin-bottom: 12px;">(Ã–rn: Tarih deÄŸiÅŸikliÄŸi, ek bilgi gerekli, vb.)</div>
                    <textarea id="reviseNote" rows="6" style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 15px; font-family: inherit; resize: vertical; min-height: 120px; line-height: 1.6;" placeholder="Revizyon gerektiren hususlarÄ± detaylÄ± olarak belirtin..."></textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeReviseModal()" style="padding: 12px 24px; border: none; border-radius: 8px; background: #e5e7eb; color: #1f2937; font-weight: 600; cursor: pointer; font-size: 14px;">Ä°ptal</button>
                    <button onclick="confirmRevise()" style="padding: 12px 24px; border: none; border-radius: 8px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; font-weight: 600; cursor: pointer; font-size: 14px; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);">Tamam</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Stat Card Animations */
        @keyframes pulse-ring {
            0%, 100% { stroke-dashoffset: 140; opacity: 1; }
            50% { stroke-dashoffset: 120; opacity: 0.8; }
        }

        @keyframes progress-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 193, 7, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 193, 7, 0.8); }
        }

        @keyframes fill-donut {
            from { stroke-dashoffset: 201; }
            to { stroke-dashoffset: 19.4; }
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes layer-slide {
            0% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
            100% { transform: translateY(0); }
        }

        @keyframes pop-in {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>

    <script src="js/app.js?v=3.6"></script>
    <script>
        const user = JSON.parse(localStorage.getItem('currentUser') || '{}');

        document.getElementById('userName').textContent = user.name || '-';
        document.getElementById('userRole').textContent = user.role === 'manager' ? 'YÃ¶netici' : user.role === 'hr' ? 'Ä°nsan KaynaklarÄ±' : user.role === 'customerRelations' ? 'MÃ¼ÅŸteri Ä°liÅŸkileri' : 'Ã‡alÄ±ÅŸan';
        document.getElementById('userAvatar').textContent = (user.name || '-').split(' ').map(n => n[0]).join('');

        // Ä°K kullanÄ±cÄ±sÄ± ise evrak sÃ¼tununu gÃ¶ster
        if (user.role === 'hr') {
            const documentColumn = document.getElementById('documentColumn');
            if (documentColumn) {
                documentColumn.style.display = 'table-cell';
            }
        }

        // Sayfa yÃ¼klendiÄŸinde tÃ¼m talepleri WorkflowEngine'den yÃ¼kle
        let allRequests = [];

        document.addEventListener('DOMContentLoaded', () => {
            loadAllRequests();
        });

        function loadAllRequests() {
            // WorkflowEngine'den tÃ¼m talepleri al
            allRequests = WorkflowEngine.getAllRequests();

            // Tabloya render et
            renderRequestsTable(allRequests);
        }

        function renderRequestsTable(requests) {
            const tbody = document.getElementById('requestsTable');

            if (requests.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #6b7280;">
                            <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“­</div>
                            <div>HenÃ¼z izin talebi bulunmuyor</div>
                        </td>
                    </tr>
                `;
                updateResultCount();
                return;
            }

            // Tarihe gÃ¶re sÄ±rala (en yeni Ã¶nce)
            const sortedRequests = [...requests].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            tbody.innerHTML = sortedRequests.map(req => {
                const leaveTypeName = getLeaveTypeName(req.type);
                const createdDate = new Date(req.createdAt).toLocaleDateString('tr-TR');
                const statusBadge = getStatusBadge(req.status);
                const statusText = getStatusText(req.status);
                const currentStepLabel = req.workflow?.steps.find(s => s.step === req.workflow.currentStep)?.label || 'N/A';

                return `
                    <tr data-status="${req.status}" data-employee="${req.userName}" data-department="${req.userDepartment}" data-start="${req.startDate}">
                        <td><strong>${req.id}</strong></td>
                        <td>${req.userName}</td>
                        <td>${req.userDepartment}</td>
                        <td><span class="badge badge-info">${leaveTypeName}</span></td>
                        <td>${req.startDate}</td>
                        <td>${req.endDate}</td>
                        <td>${req.days}</td>
                        <td><span class="badge badge-${statusBadge}">${statusText}</span></td>
                        <td>${createdDate}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="viewRequestDetail('${req.id}')">ğŸ‘ Detay</button>
                        </td>
                    </tr>
                `;
            }).join('');

            updateResultCount();
        }

        function getLeaveTypeName(type) {
            const types = {
                'annual': 'YÄ±llÄ±k Ä°zin',
                'marriage': 'Evlilik Ä°zni',
                'birth': 'DoÄŸum Ä°zni',
                'death': 'Ã–lÃ¼m Ä°zni',
                'excuse': 'Mazeret Ä°zni',
                'paternity': 'BabalÄ±k Ä°zni',
                'unpaid': 'Ãœcretsiz Ä°zin',
                'advance': 'Avans Ä°zin',
                'education': 'EÄŸitim Ä°zni',
                'sickness': 'HastalÄ±k Ä°zni',
                'adoption': 'Evlat Edinme Ä°zni'
            };
            return types[type] || type;
        }

        function getStatusBadge(status) {
            const badges = {
                'pending': 'warning',
                'manager_approved': 'info',
                'operation_approved': 'info',
                'approved': 'success',
                'manager_rejected': 'danger',
                'operation_rejected': 'danger',
                'rejected': 'danger',
                'revised': 'warning'
            };
            return badges[status] || 'secondary';
        }

        function getStatusText(status) {
            const texts = {
                'pending': 'Beklemede',
                'manager_approved': 'YÃ¶netici OnayladÄ±',
                'operation_approved': 'Operasyon OnayladÄ±',
                'approved': 'OnaylandÄ±',
                'manager_rejected': 'YÃ¶netici Reddetti',
                'operation_rejected': 'Operasyon Reddetti',
                'rejected': 'Reddedildi',
                'revised': 'Revize'
            };
            return texts[status] || status;
        }

        function filterRequests() {
            const search = document.getElementById('searchEmployee').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;
            const startDate = document.getElementById('startDateFilter').value;
            const endDate = document.getElementById('endDateFilter').value;

            const rows = document.querySelectorAll('#requestsTable tr[data-status]');
            let visibleCount = 0;

            rows.forEach(row => {
                const rowEmployee = row.getAttribute('data-employee').toLowerCase();
                const rowDepartment = row.getAttribute('data-department').toLowerCase();
                const rowStatus = row.getAttribute('data-status');
                const rowStart = row.getAttribute('data-start');

                let show = true;

                // Search filter
                if (search && !rowEmployee.includes(search) && !rowDepartment.includes(search)) {
                    show = false;
                }

                // Status filter
                if (status && rowStatus !== status) {
                    show = false;
                }

                // Date filter
                if (startDate && rowStart < startDate) {
                    show = false;
                }
                if (endDate && rowStart > endDate) {
                    show = false;
                }

                row.style.display = show ? '' : 'none';
                if (show) visibleCount++;
            });

            document.getElementById('resultCount').textContent = `${visibleCount} talep gÃ¶steriliyor`;
            document.getElementById('filterResultCount').textContent = `${visibleCount} talep`;
        }

        // WorkflowEngine verilerinden detay gÃ¶ster
        function viewRequestDetail(requestId) {
            const request = WorkflowEngine.getRequest(requestId);

            if (!request) {
                App.showNotification('Talep bulunamadÄ±!', 'error');
                return;
            }

            const leaveTypeName = getLeaveTypeName(request.type);
            const history = request.workflow.history || [];

            // Render workflow steps
            const workflowStepsHTML = request.workflow.steps.map((step, index) => {
                const isCompleted = step.status === 'completed' || step.status === 'approved';
                const isPending = step.status === 'pending';
                const isRejected = step.status === 'rejected';

                let icon, bgColor, textColor, statusText;
                if (isCompleted) {
                    icon = 'âœ“';
                    bgColor = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    textColor = '#059669';
                    statusText = 'TamamlandÄ±';
                } else if (isPending) {
                    icon = 'â±';
                    bgColor = 'linear-gradient(135deg, #FFC107 0%, #F57C00 100%)';
                    textColor = '#F57C00';
                    statusText = 'Ä°ÅŸlemde';
                } else if (isRejected) {
                    icon = 'âœ—';
                    bgColor = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                    textColor = '#dc2626';
                    statusText = 'Reddedildi';
                } else {
                    icon = index + 1;
                    bgColor = '#e5e7eb';
                    textColor = '#9ca3af';
                    statusText = 'Beklemede';
                }

                // Evrak kontrolÃ¼ durumu
                let documentInfo = '';
                if (step.requiresDocument && step.step === 'hr') {
                    if (request.documents && request.documents.length > 0) {
                        if (step.documentVerified) {
                            documentInfo = `<div style="margin-top: 6px; font-size: 12px; color: #10b981;">âœ“ Evrak kontrol edildi (${request.documents.length} dosya)</div>`;
                        } else if (isPending) {
                            documentInfo = `<div style="margin-top: 6px; font-size: 12px; color: #FFC107;">ğŸ“„ Evrak kontrolÃ¼ bekleniyor (${request.documents.length} dosya)</div>`;
                        }
                    } else if (isPending) {
                        documentInfo = `<div style="margin-top: 6px; font-size: 12px; color: #ef4444;">âš ï¸ Evrak yÃ¼klenmemiÅŸ!</div>`;
                    }
                }

                // Islak imza kontrolÃ¼ durumu (sadece Ä°K adÄ±mÄ± iÃ§in)
                let wetSignatureInfo = '';
                if (step.step === 'hr') {
                    if (step.wetSignatureVerified) {
                        const verifiedAt = step.wetSignatureVerifiedAt ? new Date(step.wetSignatureVerifiedAt).toLocaleString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : '';
                        wetSignatureInfo = `<div style="margin-top: 6px; font-size: 12px; color: #10b981;">âœ“ Islak imza kontrol edildi${verifiedAt ? ' (' + verifiedAt + ')' : ''}</div>`;
                    } else if (isPending) {
                        wetSignatureInfo = `<div style="margin-top: 6px; font-size: 12px; color: #FFC107;">âœï¸ Islak imza kontrolÃ¼ bekleniyor</div>`;
                    }
                }

                return `
                    <div style="position: relative; margin-bottom: ${index < request.workflow.steps.length - 1 ? '24px' : '0'};">
                        ${index < request.workflow.steps.length - 1 ? `
                            <div style="position: absolute; left: 19px; top: 40px; bottom: -24px; width: 2px; background: ${isCompleted ? '#10b981' : '#e5e7eb'}; z-index: 0;"></div>
                        ` : ''}
                        <div style="display: flex; align-items: start; gap: 16px;">
                            <div style="width: 40px; height: 40px; background: ${bgColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: ${isCompleted || isPending ? '0 4px 12px rgba(16, 185, 129, 0.3)' : 'none'}; z-index: 1; flex-shrink: 0;">${icon}</div>
                            <div style="flex: 1; padding-top: 4px;">
                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">${step.label}</div>
                                <div style="font-size: 13px; color: #6b7280;">${statusText}</div>
                                ${documentInfo}
                                ${wetSignatureInfo}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Render history
            const historyHTML = history.map(h => {
                const timestamp = new Date(h.timestamp).toLocaleString('tr-TR');
                let actionText = '', bgColor = '', borderColor = '';

                if (h.action === 'created') {
                    actionText = 'ğŸ“ Talep OluÅŸturuldu';
                    bgColor = '#f0fdf4';
                    borderColor = '#10b981';
                } else if (h.action === 'approved') {
                    actionText = 'âœ… OnaylandÄ±';
                    bgColor = '#f0fdf4';
                    borderColor = '#10b981';
                } else if (h.action === 'rejected') {
                    actionText = 'âŒ Reddedildi';
                    bgColor = '#fee2e2';
                    borderColor = '#ef4444';
                } else if (h.action === 'revised') {
                    actionText = 'ğŸ”„ Revize Ä°stendi';
                    bgColor = '#fff8e1';
                    borderColor = '#FFC107';
                }

                return `
                    <div style="margin-bottom: 16px; padding: 12px; background: ${bgColor}; border-left: 3px solid ${borderColor}; border-radius: 6px;">
                        <div style="font-weight: 600; margin-bottom: 4px;">${actionText}</div>
                        <div style="font-size: 12px; color: #6b7280; margin-bottom: 6px;">
                            ${h.by} â€¢ ${timestamp}
                        </div>
                        ${h.comment ? `<div style="font-size: 13px; padding: 8px; background: white; border-radius: 4px; margin-top: 6px;">${h.comment}</div>` : ''}
                    </div>
                `;
            }).join('');

            // Create detail modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                padding: 20px;
                backdrop-filter: blur(4px);
            `;

            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; max-width: 650px; width: 100%; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: modalSlideIn 0.3s ease-out;" onclick="event.stopPropagation()">
                    <div style="padding: 28px 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative;">
                        <button onclick="this.closest('[style*=fixed]').remove()" style="position: absolute; top: 20px; right: 20px; width: 36px; height: 36px; border: none; background: rgba(255, 255, 255, 0.2); border-radius: 50%; cursor: pointer; font-size: 24px; line-height: 1; color: white; transition: all 0.2s; backdrop-filter: blur(10px);">Ã—</button>
                        <h2 style="font-size: 24px; font-weight: 700; margin: 0; color: white;">ğŸ“‹ Ä°zin Talebi DetayÄ±</h2>
                        <p style="font-size: 15px; color: rgba(255, 255, 255, 0.9); margin: 8px 0 0 0; font-weight: 500;">${request.userName} â€¢ ${request.userDepartment}</p>
                    </div>

                    <div style="padding: 32px; overflow-y: auto; flex: 1; background: #f8f9fa;">
                        <!-- Talep Bilgileri -->
                        <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                            <h3 style="font-size: 14px; font-weight: 700; color: #667eea; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 0.5px;">ğŸ“‹ Talep Bilgileri</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 16px;">
                                <div>
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">Personel</div>
                                    <div style="font-size: 15px; font-weight: 600; color: #212529;">${request.userName}</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">Departman</div>
                                    <div style="font-size: 15px; font-weight: 600; color: #212529;">${request.userDepartment}</div>
                                </div>
                            </div>
                            ${(() => {
                                // Ã‡alÄ±ÅŸanÄ±n kalan izin bilgisini al
                                const userData = JSON.parse(localStorage.getItem('userData_' + request.userId) || '{}');
                                const leaveBalance = userData.leaveBalance || null;
                                if (leaveBalance) {
                                    return `
                                    <div style="background: linear-gradient(135deg, #10b98115 0%, #059f6915 100%); padding: 16px; border-radius: 10px; border-left: 4px solid #10b981; margin-bottom: 16px;">
                                        <div style="font-size: 12px; color: #6c757d; margin-bottom: 8px; font-weight: 600;">Ã‡alÄ±ÅŸanÄ±n Ä°zin Durumu</div>
                                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                                            <div style="text-align: center;">
                                                <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">Hak Edilen</div>
                                                <div style="font-size: 18px; font-weight: 700; color: #2196F3;">${leaveBalance.earned || 0}</div>
                                            </div>
                                            <div style="text-align: center;">
                                                <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">KullanÄ±lan</div>
                                                <div style="font-size: 18px; font-weight: 700; color: #FFC107;">${leaveBalance.used || 0}</div>
                                            </div>
                                            <div style="text-align: center;">
                                                <div style="font-size: 11px; color: #6c757d; margin-bottom: 4px;">Kalan</div>
                                                <div style="font-size: 18px; font-weight: 700; color: #10b981;">${leaveBalance.remaining || 0}</div>
                                            </div>
                                        </div>
                                    </div>
                                    `;
                                }
                                return '';
                            })()}
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 16px; border-radius: 10px; border-left: 4px solid #667eea;">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">Ä°zin Tipi</div>
                                    <div style="font-size: 16px; font-weight: 700; color: #667eea;">${leaveTypeName}</div>
                                </div>
                                <div style="background: linear-gradient(135deg, #20c99715 0%, #10b98115 100%); padding: 16px; border-radius: 10px; border-left: 4px solid #20c997;">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">Toplam SÃ¼re</div>
                                    <div style="font-size: 16px; font-weight: 700; color: #20c997;">${request.days}</div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px;">
                                <div>
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">BaÅŸlangÄ±Ã§</div>
                                    <div style="font-size: 15px; font-weight: 600; color: #212529;">${new Date(request.startDate).toLocaleDateString('tr-TR')}</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">BitiÅŸ</div>
                                    <div style="font-size: 15px; font-weight: 600; color: #212529;">${new Date(request.endDate).toLocaleDateString('tr-TR')}</div>
                                </div>
                            </div>
                            ${request.description ? `
                            <div style="margin-top: 16px;">
                                <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">AÃ§Ä±klama</div>
                                <div style="padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #495057;">${request.description}</div>
                            </div>
                            ` : ''}
                            ${request.documents && request.documents.length > 0 ? `
                            <div style="margin-top: 16px;">
                                <div style="font-size: 12px; color: #6c757d; margin-bottom: 8px; font-weight: 500;">YÃ¼klenen Belgeler</div>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    ${request.documents.map((doc, idx) => `
                                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e5e7eb;">
                                            <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                                                <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px;">ğŸ“„</div>
                                                <div>
                                                    <div style="font-size: 14px; font-weight: 600; color: #212529;">${doc.name}</div>
                                                    <div style="font-size: 12px; color: #6c757d;">${(doc.size / 1024).toFixed(2)} KB</div>
                                                </div>
                                            </div>
                                            <a href="${doc.data}" download="${doc.name}" style="padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 6px; text-decoration: none; font-size: 13px; font-weight: 600; transition: all 0.2s;">Ä°ndir</a>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>

                        <!-- Ä°ÅŸ AkÄ±ÅŸÄ± -->
                        <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                            <h3 style="font-size: 14px; font-weight: 700; color: #667eea; margin: 0 0 20px 0; text-transform: uppercase; letter-spacing: 0.5px;">ğŸ”„ Onay SÃ¼reci</h3>
                            ${workflowStepsHTML}
                        </div>

                        <!-- Talep GeÃ§miÅŸi -->
                        <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                            <h3 style="font-size: 14px; font-weight: 700; color: #667eea; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 0.5px;">ğŸ“œ Talep GeÃ§miÅŸi</h3>
                            ${historyHTML || '<div style="text-align: center; color: #6b7280; padding: 20px;">HenÃ¼z geÃ§miÅŸ yok</div>'}
                        </div>
                    </div>

                    <div style="padding: 20px 32px; background: white; border-top: 1px solid #e9ecef; display: flex; justify-content: flex-end; gap: 12px;">
                        <button onclick="this.closest('[style*=fixed]').remove()" class="btn btn-secondary">Kapat</button>
                    </div>
                </div>
            `;

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            document.body.appendChild(modal);
        }

        function showDetail(reqNo, employee, department, leaveType, startDate, endDate, days, status, description, rejectionReason = '') {
            const statusText = {
                pending: 'Beklemede',
                approved: 'OnaylandÄ±',
                rejected: 'Reddedildi'
            };

            const statusBadge = {
                pending: 'warning',
                approved: 'success',
                rejected: 'danger'
            };

            const statusColors = {
                pending: { bg: '#fff8e1', border: '#FFC107', text: '#F57C00' },
                approved: { bg: '#e8f5e9', border: '#4CAF50', text: '#2E7D32' },
                rejected: { bg: '#ffebee', border: '#f44336', text: '#c62828' }
            };

            const colors = statusColors[status];

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                padding: 20px;
                backdrop-filter: blur(4px);
            `;

            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; max-width: 650px; width: 100%; max-height: 85vh; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: modalSlideIn 0.3s ease-out;">
                    <!-- Header -->
                    <div style="padding: 28px 32px; background: linear-gradient(135deg, ${colors.border} 0%, ${colors.text} 100%); position: relative;">
                        <button onclick="this.closest('[style*=fixed]').remove()" style="position: absolute; top: 20px; right: 20px; width: 36px; height: 36px; border: none; background: rgba(255, 255, 255, 0.2); border-radius: 50%; cursor: pointer; font-size: 24px; line-height: 1; color: white; transition: all 0.2s; backdrop-filter: blur(10px);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">Ã—</button>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <h2 style="font-size: 24px; font-weight: 700; margin: 0; color: white;">ğŸ“‹ ${reqNo}</h2>
                            <span class="badge badge-${statusBadge[status]}" style="background: rgba(255, 255, 255, 0.9); color: ${colors.text}; font-size: 13px; padding: 6px 12px;">${statusText[status]}</span>
                        </div>
                        <p style="font-size: 15px; color: rgba(255, 255, 255, 0.9); margin: 8px 0 0 0; font-weight: 500;">${employee} â€¢ ${department}</p>
                    </div>

                    <!-- Body -->
                    <div style="padding: 32px; overflow-y: auto; flex: 1; background: #f8f9fa;">
                        <!-- Ä°zin DetaylarÄ± -->
                        <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                            <h3 style="font-size: 14px; font-weight: 700; color: ${colors.text}; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 0.5px;">ğŸ“… Ä°zin Bilgileri</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div style="background: linear-gradient(135deg, ${colors.bg} 0%, ${colors.bg}dd 100%); padding: 16px; border-radius: 10px; border-left: 4px solid ${colors.border};">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">Ä°zin Tipi</div>
                                    <div style="font-size: 16px; font-weight: 700; color: ${colors.text};">${leaveType}</div>
                                </div>
                                <div style="background: linear-gradient(135deg, ${colors.bg} 0%, ${colors.bg}dd 100%); padding: 16px; border-radius: 10px; border-left: 4px solid ${colors.border};">
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">Toplam SÃ¼re</div>
                                    <div style="font-size: 16px; font-weight: 700; color: ${colors.text};">${days}</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2" style="gap: 20px;">
                                <div>
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">ğŸ—“ BaÅŸlangÄ±Ã§</div>
                                    <div style="font-size: 15px; font-weight: 600; color: #212529; background: #f8f9fa; padding: 10px 12px; border-radius: 8px;">${startDate}</div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #6c757d; margin-bottom: 6px; font-weight: 500;">ğŸ BitiÅŸ</div>
                                    <div style="font-size: 15px; font-weight: 600; color: #212529; background: #f8f9fa; padding: 10px 12px; border-radius: 8px;">${endDate}</div>
                                </div>
                            </div>
                        </div>

                        <!-- AÃ§Ä±klama -->
                        <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                            <h3 style="font-size: 14px; font-weight: 700; color: ${colors.text}; margin: 0 0 12px 0; text-transform: uppercase; letter-spacing: 0.5px;">ğŸ’¬ AÃ§Ä±klama</h3>
                            <div style="padding: 20px; background: #f8f9fa; border-radius: 10px; font-size: 15px; line-height: 1.8; color: #495057; min-height: 100px;">${description || 'AÃ§Ä±klama eklenmedi.'}</div>
                        </div>

                        <!-- Ä°ÅŸ AkÄ±ÅŸÄ± Timeline -->
                        <div style="background: white; border-radius: 12px; padding: 24px; margin-bottom: ${rejectionReason ? '20px' : '0'}; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                            <h3 style="font-size: 14px; font-weight: 700; color: ${colors.text}; margin: 0 0 20px 0; text-transform: uppercase; letter-spacing: 0.5px;">ğŸ”„ Ä°ÅŸ AkÄ±ÅŸÄ±</h3>
                            <div style="position: relative;">
                                <!-- Timeline Line -->
                                <div style="position: absolute; left: 20px; top: 0; bottom: 0; width: 2px; background: linear-gradient(180deg, #10b981 0%, ${status === 'pending' ? '#FFC107 50%, #e5e7eb 100%' : status === 'approved' ? '#10b981 100%' : '#ef4444 50%, #e5e7eb 100%'});"></div>

                                <!-- Timeline Items -->
                                <div style="position: relative; margin-bottom: 24px;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); z-index: 1;">âœ“</div>
                                        <div style="flex: 1; padding-top: 4px;">
                                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">Talep OluÅŸturuldu</div>
                                            <div style="font-size: 13px; color: #6b7280;">${employee} tarafÄ±ndan â€¢ 03.11.2025 14:30</div>
                                            <div style="margin-top: 8px; padding: 12px; background: #f0fdf4; border-left: 3px solid #10b981; border-radius: 6px; font-size: 14px; color: #059669;">Ä°zin talebi oluÅŸturuldu</div>
                                        </div>
                                    </div>
                                </div>

                                ${status === 'pending' ? `
                                <div style="position: relative; margin-bottom: 24px;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #FFC107 0%, #F57C00 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3); z-index: 1;">â±</div>
                                        <div style="flex: 1; padding-top: 4px;">
                                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">Onay Bekliyor</div>
                                            <div style="font-size: 13px; color: #6b7280;">YÃ¶netici onayÄ± bekleniyor</div>
                                            <div style="margin-top: 8px; padding: 12px; background: #fff8e1; border-left: 3px solid #FFC107; border-radius: 6px; font-size: 14px; color: #F57C00;">Onay bekleniyor</div>
                                        </div>
                                    </div>
                                </div>

                                <div style="position: relative; margin-bottom: 24px;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: #e5e7eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #9ca3af; font-weight: bold; z-index: 1;">3</div>
                                        <div style="flex: 1; padding-top: 4px; opacity: 0.5;">
                                            <div style="font-weight: 600; color: #6b7280; margin-bottom: 4px;">Ä°K OnayÄ±</div>
                                            <div style="font-size: 13px; color: #9ca3af;">Beklemede</div>
                                        </div>
                                    </div>
                                </div>

                                <div style="position: relative;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: #e5e7eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #9ca3af; font-weight: bold; z-index: 1;">4</div>
                                        <div style="flex: 1; padding-top: 4px; opacity: 0.5;">
                                            <div style="font-weight: 600; color: #6b7280; margin-bottom: 4px;">Ä°zin KullanÄ±mÄ±</div>
                                            <div style="font-size: 13px; color: #9ca3af;">Beklemede</div>
                                        </div>
                                    </div>
                                </div>
                                ` : status === 'approved' ? `
                                <div style="position: relative; margin-bottom: 24px;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); z-index: 1;">âœ“</div>
                                        <div style="flex: 1; padding-top: 4px;">
                                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">YÃ¶netici OnayÄ±</div>
                                            <div style="font-size: 13px; color: #6b7280;">OnaylandÄ± â€¢ 04.11.2025 10:15</div>
                                            <div style="margin-top: 8px; padding: 12px; background: #f0fdf4; border-left: 3px solid #10b981; border-radius: 6px; font-size: 14px; color: #059669;">YÃ¶netici onayÄ± verildi</div>
                                        </div>
                                    </div>
                                </div>

                                <div style="position: relative; margin-bottom: 24px;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); z-index: 1;">âœ“</div>
                                        <div style="flex: 1; padding-top: 4px;">
                                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">Ä°K OnayÄ±</div>
                                            <div style="font-size: 13px; color: #6b7280;">OnaylandÄ± â€¢ 04.11.2025 15:20</div>
                                            <div style="margin-top: 8px; padding: 12px; background: #f0fdf4; border-left: 3px solid #10b981; border-radius: 6px; font-size: 14px; color: #059669;">Ä°K onayÄ± verildi</div>
                                        </div>
                                    </div>
                                </div>

                                <div style="position: relative;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); z-index: 1;">âœ“</div>
                                        <div style="flex: 1; padding-top: 4px;">
                                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">Ä°zin KullanÄ±mÄ±</div>
                                            <div style="font-size: 13px; color: #6b7280;">${startDate} - ${endDate}</div>
                                            <div style="margin-top: 8px; padding: 12px; background: #f0fdf4; border-left: 3px solid #10b981; border-radius: 6px; font-size: 14px; color: #059669;">Ä°zin onaylandÄ± ve kullanÄ±labilir</div>
                                        </div>
                                    </div>
                                </div>
                                ` : `
                                <div style="position: relative; margin-bottom: 24px;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); z-index: 1;">âœ•</div>
                                        <div style="flex: 1; padding-top: 4px;">
                                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">Talep Reddedildi</div>
                                            <div style="font-size: 13px; color: #6b7280;">Reddedildi â€¢ 04.11.2025 11:30</div>
                                            <div style="margin-top: 8px; padding: 12px; background: #fef2f2; border-left: 3px solid #ef4444; border-radius: 6px; font-size: 14px; color: #dc2626;">Ä°zin talebi reddedildi</div>
                                        </div>
                                    </div>
                                </div>

                                <div style="position: relative; margin-bottom: 24px;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: #e5e7eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #9ca3af; font-weight: bold; z-index: 1;">3</div>
                                        <div style="flex: 1; padding-top: 4px; opacity: 0.5;">
                                            <div style="font-weight: 600; color: #6b7280; margin-bottom: 4px;">Ä°K OnayÄ±</div>
                                            <div style="font-size: 13px; color: #9ca3af;">Ä°ptal edildi</div>
                                        </div>
                                    </div>
                                </div>

                                <div style="position: relative;">
                                    <div style="display: flex; align-items: start; gap: 16px;">
                                        <div style="width: 40px; height: 40px; background: #e5e7eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #9ca3af; font-weight: bold; z-index: 1;">4</div>
                                        <div style="flex: 1; padding-top: 4px; opacity: 0.5;">
                                            <div style="font-weight: 600; color: #6b7280; margin-bottom: 4px;">Ä°zin KullanÄ±mÄ±</div>
                                            <div style="font-size: 13px; color: #9ca3af;">Ä°ptal edildi</div>
                                        </div>
                                    </div>
                                </div>
                                `}
                            </div>
                        </div>

                        ${rejectionReason ? `
                            <!-- Red Sebebi -->
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border: 2px solid #f44336;">
                                <h3 style="font-size: 14px; font-weight: 700; color: #c62828; margin: 0 0 12px 0; text-transform: uppercase; letter-spacing: 0.5px;">âš ï¸ Red Sebebi</h3>
                                <div style="padding: 16px; background: #ffebee; border-radius: 10px; font-size: 14px; line-height: 1.6; color: #c62828; font-weight: 500;">${rejectionReason}</div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Footer -->
                    <div style="padding: 20px 32px; background: white; border-top: 1px solid #e9ecef; display: flex; justify-content: flex-end;">
                        <button onclick="this.closest('[style*=fixed]').remove()" class="btn btn-primary">Kapat</button>
                    </div>
                </div>

                <style>
                    @keyframes modalSlideIn {
                        from {
                            opacity: 0;
                            transform: translateY(-20px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                </style>
            `;

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.animation = 'fadeOut 0.2s ease-out';
                    setTimeout(() => modal.remove(), 200);
                }
            });

            document.body.appendChild(modal);
        }

        function approveRequest(requestId, employeeName, button) {
            if (confirm(`${employeeName} iÃ§in izin talebini onaylamak istediÄŸinize emin misiniz?`)) {
                App.showNotification(`${employeeName} iÃ§in izin talebi onaylandÄ±.`, 'success');

                // Remove row with animation (green background)
                const row = button.closest('tr');
                row.style.transition = 'all 0.3s ease';
                row.style.backgroundColor = '#e8f5e9';
                setTimeout(() => {
                    row.remove();
                    updateResultCount();
                }, 500);
            }
        }

        // Global variables for modal context
        let currentRequestId = null;
        let currentRequestRow = null;

        function rejectRequest(requestId, employeeName, button) {
            // Store context
            currentRequestId = requestId;
            currentRequestRow = button.closest('tr');

            // Set employee name and show modal
            document.getElementById('rejectEmployeeName').textContent = employeeName;
            document.getElementById('rejectReason').value = '';
            document.getElementById('rejectModal').style.display = 'flex';

            // Focus on textarea
            setTimeout(() => document.getElementById('rejectReason').focus(), 100);
        }

        function closeRejectModal() {
            document.getElementById('rejectModal').style.display = 'none';
            currentRequestId = null;
            currentRequestRow = null;
        }

        function confirmReject() {
            const reason = document.getElementById('rejectReason').value.trim();

            if (!reason) {
                alert('LÃ¼tfen red sebebini girin!');
                return;
            }

            const employeeName = document.getElementById('rejectEmployeeName').textContent;

            // Simulate rejection
            App.showNotification(`${employeeName} iÃ§in izin talebi reddedildi.`, 'warning');

            // Remove row from table
            if (currentRequestRow) {
                currentRequestRow.style.transition = 'all 0.3s ease';
                currentRequestRow.style.backgroundColor = '#ffebee';
                setTimeout(() => {
                    currentRequestRow.remove();
                    updateResultCount();
                }, 500);
            }

            closeRejectModal();
        }

        function reviseRequest(requestId, employeeName, button) {
            // Store context
            currentRequestId = requestId;
            currentRequestRow = button.closest('tr');

            // Set employee name and show modal
            document.getElementById('reviseEmployeeName').textContent = employeeName;
            document.getElementById('reviseNote').value = '';
            document.getElementById('reviseModal').style.display = 'flex';

            // Focus on textarea
            setTimeout(() => document.getElementById('reviseNote').focus(), 100);
        }

        function closeReviseModal() {
            document.getElementById('reviseModal').style.display = 'none';
            currentRequestId = null;
            currentRequestRow = null;
        }

        function confirmRevise() {
            const revisionNote = document.getElementById('reviseNote').value.trim();

            if (!revisionNote) {
                alert('LÃ¼tfen revizyon notunu girin!');
                return;
            }

            const employeeName = document.getElementById('reviseEmployeeName').textContent;

            // Simulate revision request
            App.showNotification(`${employeeName} iÃ§in revize talebi gÃ¶nderildi.`, 'info');

            // Remove row from table with orange/yellow background
            if (currentRequestRow) {
                currentRequestRow.style.transition = 'all 0.3s ease';
                currentRequestRow.style.backgroundColor = '#fff3e0';
                setTimeout(() => {
                    currentRequestRow.remove();
                    updateResultCount();
                }, 500);
            }

            closeReviseModal();
        }

        // Close modals on backdrop click
        document.getElementById('rejectModal').addEventListener('click', function(e) {
            if (e.target === this) closeRejectModal();
        });

        document.getElementById('reviseModal').addEventListener('click', function(e) {
            if (e.target === this) closeReviseModal();
        });

        // Close modals on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeRejectModal();
                closeReviseModal();
            }
        });

        function updateResultCount() {
            const rows = document.querySelectorAll('#requestsTable tr[data-status]');
            let visibleCount = 0;
            rows.forEach(row => {
                if (row.style.display !== 'none') {
                    visibleCount++;
                }
            });
            document.getElementById('resultCount').textContent = `${visibleCount} talep gÃ¶steriliyor`;
            document.getElementById('filterResultCount').textContent = `${visibleCount} talep`;
        }

        function exportExcel() {
            App.showNotification('Excel raporu indiriliyor...', 'success');
        }

        function exportPDF() {
            App.showNotification('PDF raporu indiriliyor...', 'success');
        }

        // Tarih input'larÄ±na tÄ±klandÄ±ÄŸÄ±nda takvimi otomatik aÃ§
        document.querySelectorAll('input[type="date"]').forEach(input => {
            input.addEventListener('click', function(e) {
                if (this.showPicker) {
                    try {
                        this.showPicker();
                    } catch (err) {
                        console.log('showPicker desteklenmiyor');
                    }
                }
            });
        });
    </script>
</body>
</html>